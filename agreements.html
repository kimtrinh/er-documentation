<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Service Agreements ‚Äî KP SBC ER</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=DM+Sans:wght@400;500;600;700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#080f1a;--surface:#0d1829;--surface2:#111f35;--surface3:#162540;
  --border:#1a2d48;--border2:#243d5c;
  --text:#e8f0fc;--text2:#8fa8c8;--text3:#4a6280;
  --blue:#3b82f6;--blue2:#1d4ed8;--blue3:#0d2038;
  --green:#22c55e;--green2:#15803d;--green3:#0d2d1f;
  --amber:#f59e0b;--red:#ef4444;--purple:#a78bfa;--purple2:#7e22ce;--purple3:#1f0d2d;
  --mono:'JetBrains Mono',monospace;--sans:'DM Sans',system-ui,sans-serif;
}
body{font-family:var(--sans);background:var(--bg);color:var(--text);min-height:100vh}

/* NAV */
/* HEADER */
header{background:linear-gradient(135deg,var(--purple3),var(--bg));border-bottom:2px solid var(--purple2);padding:24px 20px}
.header-inner{max-width:1000px;margin:0 auto}
.logo{display:flex;align-items:center;gap:12px;margin-bottom:5px}
.logo span{font-size:26px}
.logo h1{font-size:20px;font-weight:800;color:var(--text)}
.logo .badge{background:var(--purple2);color:#e9d5ff;font-size:10px;font-weight:700;padding:3px 10px;border-radius:20px;letter-spacing:.5px;text-transform:uppercase}
.subtitle{font-size:13px;color:#a78bfa;margin-left:38px}

main{max-width:1000px;margin:0 auto;padding:28px 20px 80px}

/* DISCLAIMER */
.disclaimer{background:var(--blue3);border:1px solid var(--blue2);border-radius:8px;padding:10px 14px;margin-bottom:24px;font-size:12px;color:#93c5fd;line-height:1.5}
.disclaimer strong{color:#bfdbfe}

/* SPECIALTY FILTER */
.filter-bar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:20px;align-items:center}
.filter-btn{padding:6px 14px;border-radius:20px;border:1px solid var(--border);background:var(--surface);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .15s}
.filter-btn:hover{border-color:var(--border2);color:var(--text)}
.filter-btn.active{background:var(--purple2);border-color:var(--purple2);color:#fff}

/* AGREEMENT CARDS */
.ag-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px}
.ag-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;transition:all .15s}
.ag-card:hover{border-color:var(--border2)}
.ag-head{padding:14px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}
.ag-icon{font-size:22px;flex-shrink:0}
.ag-specialty{font-size:15px;font-weight:700;color:var(--text)}
.ag-subtitle{font-size:11px;color:var(--text3);margin-top:2px}
.ag-status{margin-left:auto;display:flex;align-items:center;gap:5px;font-size:11px;font-weight:700;flex-shrink:0}
.status-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.dot-green{background:var(--green)}
.dot-amber{background:var(--amber)}
.dot-gray{background:var(--text3)}
.ag-body{padding:14px 16px}
.ag-section{margin-bottom:12px}
.ag-section:last-child{margin-bottom:0}
.ag-section-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);margin-bottom:5px}
.ag-content{font-size:13px;color:var(--text2);line-height:1.6}
.ag-content ul{padding-left:16px}
.ag-content li{margin-bottom:2px}
.ag-tag-row{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
.ag-tag{font-size:11px;padding:2px 8px;border-radius:20px;font-weight:600}
.ag-tag-purple{background:var(--purple3);color:#c084fc;border:1px solid var(--purple2)}
.ag-tag-blue{background:var(--blue3);color:#38bdf8;border:1px solid #0369a1}
.ag-tag-green{background:var(--green3);color:#4ade80;border:1px solid var(--green2)}
.ag-tag-amber{background:#2d1f0d;color:#fbbf24;border:1px solid #a16207}

/* EMPTY STATE */
.empty-state{text-align:center;padding:60px 20px}
.empty-icon{font-size:48px;margin-bottom:16px;opacity:.5}
.empty-title{font-size:18px;font-weight:700;color:var(--text2);margin-bottom:8px}
.empty-desc{font-size:14px;color:var(--text3);line-height:1.6;max-width:480px;margin:0 auto 24px}
.empty-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;background:var(--purple2);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:700;cursor:pointer;font-family:var(--sans);transition:opacity .15s}
.empty-btn:hover{opacity:.85}

/* ADD MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:200;opacity:0;pointer-events:none;transition:opacity .2s;backdrop-filter:blur(4px)}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{background:var(--surface);border:1px solid var(--border2);border-radius:12px;width:520px;max-width:95vw;max-height:90vh;overflow-y:auto;transform:translateY(10px);transition:transform .2s}
.modal-overlay.open .modal{transform:translateY(0)}
.modal-head{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.modal-title{font-size:15px;font-weight:700;color:var(--text)}
.modal-close{background:none;border:none;color:var(--text3);cursor:pointer;font-size:20px;padding:2px 6px;border-radius:4px;line-height:1}
.modal-close:hover{background:var(--surface2);color:var(--text)}
.modal-body{padding:20px;display:flex;flex-direction:column;gap:14px}
.form-group{display:flex;flex-direction:column;gap:6px}
.form-label{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--text3)}
.form-input,.form-textarea,.form-select{background:var(--bg);border:1px solid var(--border2);border-radius:8px;color:var(--text);font-family:var(--sans);font-size:13px;padding:9px 12px;outline:none;transition:border-color .15s;width:100%}
.form-input:focus,.form-textarea:focus,.form-select:focus{border-color:var(--purple)}
.form-textarea{resize:vertical;min-height:80px;line-height:1.5}
.form-select option{background:var(--surface2)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.modal-foot{padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px}
.btn{padding:8px 18px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid var(--border);font-family:var(--sans);transition:all .15s}
.btn-ghost{background:transparent;color:var(--text2)}
.btn-ghost:hover{background:var(--surface2);color:var(--text)}
.btn-primary{background:var(--purple2);border-color:var(--purple2);color:#fff}
.btn-primary:hover{opacity:.85}

/* HOWTO */
.howto{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:28px}
.howto-title{font-size:14px;font-weight:700;color:var(--text);margin-bottom:10px;display:flex;align-items:center;gap:8px}
.howto-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
.howto-step{background:var(--surface2);border-radius:8px;padding:12px 14px}
.step-num{font-size:10px;font-weight:800;color:var(--purple);font-family:var(--mono);margin-bottom:4px}
.step-title{font-size:13px;font-weight:700;color:var(--text);margin-bottom:3px}
.step-desc{font-size:11px;color:var(--text3);line-height:1.5}

@media(max-width:640px){.form-row{grid-template-columns:1fr}}
.sitenav{background:#0d1829;border-bottom:1px solid #1a2d48;position:sticky;top:0;z-index:100;font-family:'DM Sans',system-ui,sans-serif}
.sitenav-inner{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;align-items:center;gap:6px;height:46px}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:#3b82f6;white-space:nowrap;flex-shrink:0;text-decoration:none;margin-right:6px}
.nav-logo span{color:#4a6280}
.nav-links{display:flex;gap:1px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.nav-links::-webkit-scrollbar{display:none}
.nav-link{padding:5px 10px;border-radius:6px;font-size:12px;font-weight:600;color:#8fa8c8;text-decoration:none;white-space:nowrap;transition:all .15s}
.nav-link:hover{background:#111f35;color:#e8f0fc}
.nav-link.active{background:#1d4ed8;color:#fff}
@media(max-width:640px){.nav-link{font-size:11px;padding:4px 8px}}
</style>
</head>
<body>
<nav class="sitenav">
  <div class="sitenav-inner">
    <a class="nav-logo" href="index.html">‚ö° KP<span>/</span>ER</a>
    <div class="nav-links">
      <a class="nav-link" href="index.html">üè† Home</a>
      <a class="nav-link" href="dotphrase.html">üìã Phrases</a>
      <a class="nav-link" href="calculators.html">üßÆ Calcs</a>
      <a class="nav-link" href="vasopressors.html">üíä Vasopressors</a>
      <a class="nav-link" href="rsi.html">ü´Å RSI</a>
      <a class="nav-link" href="algorithms.html">üîÄ Algorithms</a>
      <a class="nav-link" href="neurohub.html">üß† Neuro Hub</a>
      <a class="nav-link" href="pedsfever.html">üå°Ô∏è Peds Fever</a>
      <a class="nav-link" href="service-agreements.html">üìë Service Agreements</a>
      <a class="nav-link" href="ed-phone-directory.html">üìû Directory</a>
      <a class="nav-link" href="links.html">üîó Links</a>
      <a class="nav-link" href="roadmap.html">üó∫Ô∏è Roadmap</a>
    </div>
  </div>
</nav>
<!-- NAV -->
<header>
  <div class="header-inner">
    <div class="logo"><span>ü§ù</span><h1>Service Agreements</h1><span class="badge">KP SBC</span></div>
    <p class="subtitle">Consult criteria ¬∑ response time expectations ¬∑ escalation paths by specialty</p>
  </div>
</header>

<main>
  <div class="disclaimer"><strong>‚ö†Ô∏è Note:</strong> This page is for quick bedside reference only. Service agreements are institutional documents ‚Äî always follow current official KP SBC departmental policies. Contact your chief or department lead if there is any discrepancy.</div>

  <div class="howto">
    <div class="howto-title">üí° How to use this page</div>
    <div class="howto-grid">
      <div class="howto-step"><div class="step-num">STEP 01</div><div class="step-title">Click "Add Agreement"</div><div class="step-desc">Fill in specialty, consult criteria, response time, and escalation info.</div></div>
      <div class="howto-step"><div class="step-num">STEP 02</div><div class="step-title">Agreements are saved locally</div><div class="step-desc">Stored in your browser. Persists across sessions on the same device.</div></div>
      <div class="howto-step"><div class="step-num">STEP 03</div><div class="step-title">Search from any page</div><div class="step-desc">All agreement content is searchable from the global search bar above.</div></div>
      <div class="howto-step"><div class="step-num">STEP 04</div><div class="step-title">Filter by specialty</div><div class="step-desc">Use the filter buttons to quickly find the service you need.</div></div>
    </div>
  </div>

  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px">
    <div class="filter-bar" id="filterBar">
      <button class="filter-btn active" onclick="filterAgreements('All',this)">All</button>
    </div>
    <button class="btn btn-primary" onclick="openModal()">+ Add Agreement</button>
  </div>

  <div class="ag-grid" id="agGrid"></div>
  <div class="empty-state" id="emptyState">
    <div class="empty-icon">ü§ù</div>
    <div class="empty-title">No service agreements yet</div>
    <div class="empty-desc">Add your first service agreement to document consult criteria, expected response times, on-call coverage, and escalation paths by specialty. Perfect for those 3am "what are they supposed to cover?" moments.</div>
    <button class="empty-btn" onclick="openModal()">+ Add First Agreement</button>
  </div>
</main>

<!-- ADD AGREEMENT MODAL -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-head">
      <span class="modal-title" id="modalTitle">Add Service Agreement</span>
      <button class="modal-close" onclick="closeModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Specialty</label>
          <input class="form-input" id="agSpecialty" placeholder="e.g. Cardiology" type="text"/>
        </div>
        <div class="form-group">
          <label class="form-label">Category</label>
          <select class="form-select" id="agCategory">
            <option value="Medical">Medical</option>
            <option value="Surgical">Surgical</option>
            <option value="OB/GYN">OB/GYN</option>
            <option value="Neuro">Neuro</option>
            <option value="Pediatrics">Pediatrics</option>
            <option value="Psychiatry">Psychiatry</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Consult Criteria / What they cover</label>
        <textarea class="form-textarea" id="agCriteria" placeholder="e.g. STEMI activation, ACS with positive troponin, unstable dysrhythmia, heart failure admission..."></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Response Time Expectation</label>
        <input class="form-input" id="agResponse" placeholder="e.g. At bedside within 30 min for STEMI, phone response within 15 min for ACS" type="text"/>
      </div>
      <div class="form-group">
        <label class="form-label">On-Call Coverage / Hours</label>
        <input class="form-input" id="agCoverage" placeholder="e.g. 24/7 in-house, pager after hours, attending only 10pm‚Äì7am" type="text"/>
      </div>
      <div class="form-group">
        <label class="form-label">Escalation Path</label>
        <textarea class="form-textarea" id="agEscalation" placeholder="e.g. If no response in 15 min ‚Üí call attending directly ‚Üí notify charge MD ‚Üí document in chart"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Notes / Exclusions / Special Situations</label>
        <textarea class="form-textarea" id="agNotes" placeholder="e.g. Does NOT cover outpatient follow-up. Plastics not available ‚Äî use hand surgery. Pediatric consults go to FMC after hours."></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="agStatus">
            <option value="active">Active</option>
            <option value="draft">Draft / Verify</option>
            <option value="pending">Pending Update</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Icon (emoji)</label>
          <input class="form-input" id="agIcon" placeholder="e.g. ‚ù§Ô∏è üß† ü´Ä" type="text" value="üè•"/>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveAgreement()">Save Agreement</button>
    </div>
  </div>
</div>

<script src="search-index.js"></script>
<script>
// ===== SHARED SEARCH INDEX (same as index.html) =====
// ===== AGREEMENTS =====
let agreements = JSON.parse(localStorage.getItem('er_agreements') || '[]');
let editIndex = -1;
let activeFilter = 'All';

function saveToStorage() { localStorage.setItem('er_agreements', JSON.stringify(agreements)); }
function escapeHtml(value) {
  return String(value ?? '').replace(/[&<>"']/g, ch => (
    ch === '&' ? '&amp;' :
    ch === '<' ? '&lt;' :
    ch === '>' ? '&gt;' :
    ch === '"' ? '&quot;' : '&#39;'
  ));
}

function openModal(idx) {
  editIndex = idx !== undefined ? idx : -1;
  const m = document.getElementById('modalTitle');
  if (editIndex >= 0) {
    m.textContent = 'Edit Agreement';
    const a = agreements[editIndex];
    document.getElementById('agSpecialty').value = a.specialty || '';
    document.getElementById('agCategory').value = a.category || 'Medical';
    document.getElementById('agCriteria').value = a.criteria || '';
    document.getElementById('agResponse').value = a.response || '';
    document.getElementById('agCoverage').value = a.coverage || '';
    document.getElementById('agEscalation').value = a.escalation || '';
    document.getElementById('agNotes').value = a.notes || '';
    document.getElementById('agStatus').value = a.status || 'active';
    document.getElementById('agIcon').value = a.icon || 'üè•';
  } else {
    m.textContent = 'Add Service Agreement';
    ['agSpecialty','agCriteria','agResponse','agCoverage','agEscalation','agNotes'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('agCategory').value = 'Medical';
    document.getElementById('agStatus').value = 'active';
    document.getElementById('agIcon').value = 'üè•';
  }
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal() { document.getElementById('modalOverlay').classList.remove('open'); }

function saveAgreement() {
  const a = {
    specialty: document.getElementById('agSpecialty').value.trim(),
    category: document.getElementById('agCategory').value,
    criteria: document.getElementById('agCriteria').value.trim(),
    response: document.getElementById('agResponse').value.trim(),
    coverage: document.getElementById('agCoverage').value.trim(),
    escalation: document.getElementById('agEscalation').value.trim(),
    notes: document.getElementById('agNotes').value.trim(),
    status: document.getElementById('agStatus').value,
    icon: document.getElementById('agIcon').value.trim() || 'üè•',
    added: new Date().toLocaleDateString()
  };
  if (!a.specialty) { alert('Please enter a specialty name.'); return; }
  if (editIndex >= 0) agreements[editIndex] = a;
  else agreements.push(a);
  saveToStorage();
  closeModal();
  render();
}

function deleteAgreement(idx) {
  if (!confirm('Delete this agreement?')) return;
  agreements.splice(idx, 1);
  saveToStorage();
  render();
}

function filterAgreements(filter, btn) {
  activeFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

const STATUS_MAP = { active: {dot:'dot-green', label:'Active'}, draft: {dot:'dot-amber', label:'Draft'}, pending: {dot:'dot-amber', label:'Pending'} };

function render() {
  const filtered = activeFilter === 'All' ? agreements : agreements.filter(a => a.category === activeFilter);
  const grid = document.getElementById('agGrid');
  const empty = document.getElementById('emptyState');

  // rebuild filters
  const cats = ['All', ...Array.from(new Set(agreements.map(a => a.category)))];
  const fb = document.getElementById('filterBar');
  fb.innerHTML = cats.map(c => (
    `<button class="filter-btn${c===activeFilter?' active':''}" data-filter="${escapeHtml(c)}">${escapeHtml(c)}</button>`
  )).join('');
  fb.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => filterAgreements(btn.dataset.filter, btn));
  });

  if (!filtered.length) {
    grid.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  grid.innerHTML = filtered.map((a, i) => {
    const realIdx = agreements.indexOf(a);
    const s = STATUS_MAP[a.status] || STATUS_MAP.active;
    const safeIcon = escapeHtml(a.icon || 'üè•');
    const safeSpecialty = escapeHtml(a.specialty || '');
    const safeCategory = escapeHtml(a.category || '');
    const safeCriteria = escapeHtml(a.criteria || '');
    const safeResponse = escapeHtml(a.response || '');
    const safeCoverage = escapeHtml(a.coverage || '');
    const safeEscalation = escapeHtml(a.escalation || '');
    const safeNotes = escapeHtml(a.notes || '');
    const safeAdded = escapeHtml(a.added || '');
    return `<div class="ag-card">
      <div class="ag-head">
        <span class="ag-icon">${safeIcon}</span>
        <div>
          <div class="ag-specialty">${safeSpecialty}</div>
          <div class="ag-subtitle">${safeCategory}</div>
        </div>
        <div class="ag-status"><span class="status-dot ${s.dot}"></span><span style="color:var(--text2)">${s.label}</span></div>
      </div>
      <div class="ag-body">
        ${safeCriteria ? `<div class="ag-section"><div class="ag-section-label">Consult Criteria</div><div class="ag-content">${safeCriteria}</div></div>` : ''}
        ${safeResponse ? `<div class="ag-section"><div class="ag-section-label">Response Time</div><div class="ag-content">${safeResponse}</div></div>` : ''}
        ${safeCoverage ? `<div class="ag-section"><div class="ag-section-label">Coverage / Hours</div><div class="ag-content">${safeCoverage}</div></div>` : ''}
        ${safeEscalation ? `<div class="ag-section"><div class="ag-section-label">Escalation Path</div><div class="ag-content">${safeEscalation}</div></div>` : ''}
        ${safeNotes ? `<div class="ag-section"><div class="ag-section-label">Notes / Exclusions</div><div class="ag-content" style="color:var(--amber)">${safeNotes}</div></div>` : ''}
        <div style="display:flex;gap:8px;margin-top:12px;padding-top:10px;border-top:1px solid var(--border)">
          <button class="btn btn-ghost" style="font-size:11px;padding:5px 12px" onclick="openModal(${realIdx})">Edit</button>
          <button class="btn" style="font-size:11px;padding:5px 12px;background:transparent;color:var(--red);border-color:var(--border)" onclick="deleteAgreement(${realIdx})">Delete</button>
          ${safeAdded ? `<span style="margin-left:auto;font-size:10px;color:var(--text3);align-self:center">Added ${safeAdded}</span>` : ''}
        </div>
      </div>
    </div>`;
  }).join('');
}

render();
</script>
</body>
</html>
