<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ER Calculators</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',system-ui,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}

/* NAV */
.sitenav{background:#1e293b;border-bottom:1px solid #334155;padding:0 24px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.sitenav-inner{max-width:980px;margin:0 auto;display:flex;gap:2px;padding:8px 0}
.sitenav a{padding:7px 14px;border-radius:8px;font-size:13px;font-weight:500;color:#94a3b8;text-decoration:none;white-space:nowrap;transition:all .2s}
.sitenav a:hover{background:#334155;color:#f1f5f9}
.sitenav a.active{background:#3b82f6;color:#fff}

header{background:linear-gradient(135deg,#1e293b,#0f172a);border-bottom:1px solid #1e3a5f;padding:20px 24px}
.header-inner{max-width:980px;margin:0 auto}
.logo{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.logo span{font-size:22px}.logo h1{font-size:20px;font-weight:700;color:#f1f5f9}
.subtitle{font-size:13px;color:#64748b;margin-left:32px}

main{max-width:980px;margin:0 auto;padding:24px}
.calc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:24px}

/* CALC TABS */
.calc-tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap}
.calc-tab{padding:8px 18px;border-radius:20px;border:none;cursor:pointer;font-size:14px;font-weight:600;background:#1e293b;color:#94a3b8;transition:all .2s}
.calc-tab.active{background:#3b82f6;color:#fff}

/* CARD */
.card{background:#1e293b;border:1px solid #334155;border-radius:14px;overflow:hidden}
.card-title{padding:14px 18px;border-bottom:1px solid #334155;font-weight:700;font-size:15px;color:#f1f5f9;display:flex;align-items:center;gap:8px}
.card-body{padding:16px 18px}

/* CRITERIA */
.criterion{display:flex;align-items:flex-start;gap:12px;padding:10px 0;border-bottom:1px solid #1e293b;cursor:pointer;user-select:none}
.criterion:last-child{border-bottom:none}
.criterion input[type=checkbox]{width:18px;height:18px;accent-color:#3b82f6;flex-shrink:0;margin-top:2px;cursor:pointer}
.criterion-label{font-size:13px;color:#cbd5e1;line-height:1.5;flex:1}
.criterion-pts{font-size:12px;font-weight:700;color:#38bdf8;white-space:nowrap;margin-top:2px}

/* RADIO */
.radio-group{margin-bottom:10px}
.radio-group label{display:block;font-size:12px;color:#64748b;margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.radio-option{display:flex;align-items:center;gap:8px;padding:8px 0;cursor:pointer;font-size:13px;color:#cbd5e1;border-bottom:1px solid #1e293b}
.radio-option:last-child{border-bottom:none}
.radio-option input{accent-color:#3b82f6;width:16px;height:16px;cursor:pointer;flex-shrink:0}
.radio-option span{flex:1;line-height:1.4}
.radio-option .radio-pts{font-size:12px;font-weight:700;color:#38bdf8;white-space:nowrap}

/* RESULT */
.result{margin-top:16px;border-radius:10px;padding:14px 16px;border:1px solid}
.result.low{background:#052e16;border-color:#16a34a;color:#86efac}
.result.moderate{background:#1c1917;border-color:#ca8a04;color:#fde047}
.result.high{background:#1f0707;border-color:#dc2626;color:#fca5a5}
.result.neutral{background:#1e293b;border-color:#334155;color:#94a3b8}
.result-score{font-size:24px;font-weight:800;margin-bottom:4px}
.result-label{font-size:14px;font-weight:600;margin-bottom:6px}
.result-action{font-size:12px;line-height:1.6;opacity:.9}

/* COPY DOC BUTTON */
.copy-doc-btn{margin-top:10px;padding:8px 16px;border-radius:8px;border:1px solid #3b82f6;background:#1e3a5f;color:#93c5fd;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;width:100%;display:none;align-items:center;justify-content:center;gap:6px}
.copy-doc-btn:hover{background:#2563eb;color:#fff;border-color:#2563eb}
.copy-doc-btn.show{display:flex}
.copy-doc-btn.copied{background:#052e16;border-color:#16a34a;color:#86efac}

.reset-btn{margin-top:8px;padding:7px 16px;border-radius:8px;border:1px solid #334155;background:transparent;color:#64748b;font-size:12px;cursor:pointer;transition:all .2s;width:100%}
.reset-btn:hover{background:#334155;color:#f1f5f9}

.disclaimer{background:#1e3a5f;border:1px solid #2563eb;border-radius:8px;padding:10px 14px;margin-bottom:20px;font-size:12px;color:#93c5fd;line-height:1.5}
.disclaimer strong{color:#bfdbfe}

@media(max-width:600px){main{padding:16px}}

/* INPUTS */
.input{width:100%;padding:10px;border-radius:10px;border:1px solid #334155;background:#0f172a;color:#e2e8f0;outline:none}
.input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.2)}
</style>
</head>
<body>

<div class="sitenav">
  <div class="sitenav-inner">
    <a href="index.html">üìã Dotphrases</a>
    <a href="calculators.html" class="active">üßÆ Calculators</a>
    <a href="vasopressors.html">üíä Vasopressors</a>
    <a href="rsi.html">ü´Å RSI</a>
    <a href="pedsfever.html">üå°Ô∏è Peds Fever</a>
    <a href="algorithms.html">üîÄ Algorithms</a>
    <a href="neurohub.html">üß† Neuro Hub</a>
    <a href="roadmap.html">üó∫Ô∏è Roadmap</a>
    <a href="links.html">üîó Links</a>
      <a href="ed-phone-directory.html">üìû Phone Directory</a>
</div>
</div>

<header>
  <div class="header-inner">
    <div class="logo"><span>üßÆ</span><h1>ER Clinical Calculators</h1></div>
    <p class="subtitle">Wells PE ¬∑ PERC ¬∑ Wells DVT ¬∑ HEART ¬∑ Adult Head CT Rules ¬∑ PECARN ¬∑ Centor</p>
  </div>
</header>

<main>
  <div class="disclaimer"><strong>‚ö†Ô∏è Clinical Disclaimer:</strong> Calculators are decision-support tools only. Always apply clinical judgment. Scores do not replace physician assessment.</div>

  <div class="calc-tabs">
    <button class="calc-tab active" onclick="showCalc('wellspe')">ü´Å Wells PE + PERC</button>
    <button class="calc-tab" onclick="showCalc('heart')">‚ù§Ô∏è HEART Score</button>
    <button class="calc-tab" onclick="showCalc('wellsdvt')">ü¶µ Wells DVT</button>
    <button class="calc-tab" onclick="showCalc('cthead')">üß† Head CT Rules (Adult)</button>
    <button class="calc-tab" onclick="showCalc('pecarn')">üßí PECARN Head Injury</button>
    <button class="calc-tab" onclick="showCalc('centor')">ü¶† Strep (Centor/McIsaac)</button>
    <button class="calc-tab" onclick="showCalc('pedsfever')">üå°Ô∏è Peds Fever</button>
    <button class="calc-tab" onclick="showCalc('softtissue')">ü¶† Soft Tissue & Sepsis</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WELLS PE + PERC
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-wellspe">
    <div class="calc-grid">

      <!-- PERC -->
      <div class="card">
        <div class="card-title">üîç PERC Rule <span style="font-size:12px;font-weight:400;color:#64748b">‚Äî Rule OUT PE (use first)</span></div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:12px">All 8 must be <strong style="color:#f1f5f9">absent</strong> to PERC-negative. Use only if Wells PE &lt;2 (low pre-test probability).</p>
          <div id="perc-criteria">
            <div class="criterion" onclick="togglePerc(0)"><input type="checkbox" id="perc0"> <span class="criterion-label">Age ‚â• 50</span></div>
            <div class="criterion" onclick="togglePerc(1)"><input type="checkbox" id="perc1"> <span class="criterion-label">HR ‚â• 100 bpm</span></div>
            <div class="criterion" onclick="togglePerc(2)"><input type="checkbox" id="perc2"> <span class="criterion-label">SpO‚ÇÇ &lt; 95% on room air</span></div>
            <div class="criterion" onclick="togglePerc(3)"><input type="checkbox" id="perc3"> <span class="criterion-label">Unilateral leg swelling</span></div>
            <div class="criterion" onclick="togglePerc(4)"><input type="checkbox" id="perc4"> <span class="criterion-label">Hemoptysis</span></div>
            <div class="criterion" onclick="togglePerc(5)"><input type="checkbox" id="perc5"> <span class="criterion-label">Recent surgery or trauma (‚â§4 weeks)</span></div>
            <div class="criterion" onclick="togglePerc(6)"><input type="checkbox" id="perc6"> <span class="criterion-label">Prior PE or DVT</span></div>
            <div class="criterion" onclick="togglePerc(7)"><input type="checkbox" id="perc7"> <span class="criterion-label">Hormone use (OCP, HRT, or estrogenic)</span></div>
          </div>
          <div id="perc-result" class="result neutral">
            <div class="result-label">Check criteria above</div>
            <div class="result-action">All 8 must be absent to rule out PE without further testing.</div>
          </div>
          <button id="perc-copy-btn" class="copy-doc-btn" onclick="copyDoc('perc')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetPerc()">Reset</button>
        </div>
      </div>

      <!-- WELLS PE -->
      <div class="card">
        <div class="card-title">‚öñÔ∏è Wells PE Score</div>
        <div class="card-body">
          <div id="wellspe-criteria">
            <div class="criterion" onclick="toggleWellsPE(0,3)"><input type="checkbox" id="wpe0"><span class="criterion-label">Clinical signs/symptoms of DVT</span><span class="criterion-pts">+3</span></div>
            <div class="criterion" onclick="toggleWellsPE(1,3)"><input type="checkbox" id="wpe1"><span class="criterion-label">PE is #1 diagnosis OR equally likely</span><span class="criterion-pts">+3</span></div>
            <div class="criterion" onclick="toggleWellsPE(2,1.5)"><input type="checkbox" id="wpe2"><span class="criterion-label">HR &gt; 100 bpm</span><span class="criterion-pts">+1.5</span></div>
            <div class="criterion" onclick="toggleWellsPE(3,1.5)"><input type="checkbox" id="wpe3"><span class="criterion-label">Immobilization ‚â•3 days OR surgery in past 4 weeks</span><span class="criterion-pts">+1.5</span></div>
            <div class="criterion" onclick="toggleWellsPE(4,1.5)"><input type="checkbox" id="wpe4"><span class="criterion-label">Prior PE or DVT</span><span class="criterion-pts">+1.5</span></div>
            <div class="criterion" onclick="toggleWellsPE(5,1)"><input type="checkbox" id="wpe5"><span class="criterion-label">Hemoptysis</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsPE(6,1)"><input type="checkbox" id="wpe6"><span class="criterion-label">Malignancy (treatment within 6 months or palliative)</span><span class="criterion-pts">+1</span></div>
          </div>
          <div id="wellspe-result" class="result neutral">
            <div class="result-score">0</div>
            <div class="result-label">Select criteria above</div>
            <div class="result-action">‚Äî</div>
          </div>
          <button id="wellspe-copy-btn" class="copy-doc-btn" onclick="copyDoc('wellspe')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetWellsPE()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HEART SCORE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-heart" style="display:none">
    <div class="calc-grid">

      <div class="card">
        <div class="card-title">‚ù§Ô∏è HEART Score <span style="font-size:12px;font-weight:400;color:#64748b">‚Äî Chest Pain Risk Stratification</span></div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:14px">Each category scored 0‚Äì2. Score ‚â§3 = low risk (MACE &lt;2%). Use with serial troponins.</p>

          <!-- H: History -->
          <div class="radio-group">
            <label>H ‚Äî History</label>
            <div class="radio-option" onclick="setHEART('h',0,this)"><input type="radio" name="heart-h" value="0"><span>Slightly suspicious ‚Äî mostly non-specific features</span><span class="radio-pts">0</span></div>
            <div class="radio-option" onclick="setHEART('h',1,this)"><input type="radio" name="heart-h" value="1"><span>Moderately suspicious ‚Äî features of ACS but not classic</span><span class="radio-pts">+1</span></div>
            <div class="radio-option" onclick="setHEART('h',2,this)"><input type="radio" name="heart-h" value="2"><span>Highly suspicious ‚Äî classic exertional, pressure-type, radiation</span><span class="radio-pts">+2</span></div>
          </div>

          <!-- E: EKG -->
          <div class="radio-group">
            <label>E ‚Äî EKG</label>
            <div class="radio-option" onclick="setHEART('e',0,this)"><input type="radio" name="heart-e" value="0"><span>Normal</span><span class="radio-pts">0</span></div>
            <div class="radio-option" onclick="setHEART('e',1,this)"><input type="radio" name="heart-e" value="1"><span>Non-specific repolarization disturbance (LBBB, pacemaker, early repol, LVH, ST depression ‚â§1mm)</span><span class="radio-pts">+1</span></div>
            <div class="radio-option" onclick="setHEART('e',2,this)"><input type="radio" name="heart-e" value="2"><span>Significant ST deviation ‚Äî ST depression &gt;1mm, new ST elevation, T-wave inversion</span><span class="radio-pts">+2</span></div>
          </div>

          <!-- A: Age -->
          <div class="radio-group">
            <label>A ‚Äî Age</label>
            <div class="radio-option" onclick="setHEART('a',0,this)"><input type="radio" name="heart-a" value="0"><span>Age &lt; 45</span><span class="radio-pts">0</span></div>
            <div class="radio-option" onclick="setHEART('a',1,this)"><input type="radio" name="heart-a" value="1"><span>Age 45‚Äì64</span><span class="radio-pts">+1</span></div>
            <div class="radio-option" onclick="setHEART('a',2,this)"><input type="radio" name="heart-a" value="2"><span>Age ‚â• 65</span><span class="radio-pts">+2</span></div>
          </div>

          <!-- R: Risk Factors -->
          <div class="radio-group">
            <label>R ‚Äî Risk Factors (HTN, hypercholesterolemia, DM, obesity BMI&gt;30, smoking, family hx, atherosclerosis)</label>
            <div class="radio-option" onclick="setHEART('r',0,this)"><input type="radio" name="heart-r" value="0"><span>No known risk factors</span><span class="radio-pts">0</span></div>
            <div class="radio-option" onclick="setHEART('r',1,this)"><input type="radio" name="heart-r" value="1"><span>1‚Äì2 risk factors</span><span class="radio-pts">+1</span></div>
            <div class="radio-option" onclick="setHEART('r',2,this)"><input type="radio" name="heart-r" value="2"><span>‚â•3 risk factors OR known CAD / atherosclerotic disease</span><span class="radio-pts">+2</span></div>
          </div>

          <!-- T: Troponin -->
          <div class="radio-group">
            <label>T ‚Äî Troponin (relative to institutional upper limit of normal)</label>
            <div class="radio-option" onclick="setHEART('t',0,this)"><input type="radio" name="heart-t" value="0"><span>‚â§ normal limit (‚â§1√ó ULN)</span><span class="radio-pts">0</span></div>
            <div class="radio-option" onclick="setHEART('t',1,this)"><input type="radio" name="heart-t" value="1"><span>1‚Äì3√ó ULN</span><span class="radio-pts">+1</span></div>
            <div class="radio-option" onclick="setHEART('t',2,this)"><input type="radio" name="heart-t" value="2"><span>&gt;3√ó ULN</span><span class="radio-pts">+2</span></div>
          </div>

          <div id="heart-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Select all categories above</div>
            <div class="result-action">Score each domain to calculate HEART score.</div>
          </div>
          <button id="heart-copy-btn" class="copy-doc-btn" onclick="copyDoc('heart')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetHEART()">Reset</button>
        </div>
      </div>

      <!-- Interpretation reference -->
      <div class="card" style="align-self:start">
        <div class="card-title">üìä HEART Score Interpretation</div>
        <div class="card-body" style="font-size:13px;line-height:1.9;color:#cbd5e1">
          <p style="margin-bottom:10px;color:#64748b;font-size:12px">6-week MACE risk (death, MI, revascularization):</p>
          <p><span style="color:#86efac;font-weight:700">0‚Äì3 ‚Äî Low Risk</span><br/>MACE ~1.7%. Eligible for early discharge with outpatient follow-up if serial troponins negative. Shared decision-making discussion documented.</p>
          <br/>
          <p><span style="color:#fde047;font-weight:700">4‚Äì6 ‚Äî Moderate Risk</span><br/>MACE ~12‚Äì17%. Consider observation, stress testing, or cardiology consult. Not safe for routine discharge without further evaluation.</p>
          <br/>
          <p><span style="color:#fca5a5;font-weight:700">7‚Äì10 ‚Äî High Risk</span><br/>MACE ~50‚Äì65%. Early invasive strategy indicated. Cardiology consult, admission, likely catheterization.</p>
          <br/>
          <p style="font-size:12px;color:#475569;border-top:1px solid #334155;padding-top:10px">‚ö†Ô∏è HEART score does <strong style="color:#94a3b8">not</strong> replace clinical judgment. Patients with STEMI, new LBBB, or hemodynamic instability require immediate intervention regardless of score.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WELLS DVT
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-wellsdvt" style="display:none">
    <div class="calc-grid">
      <div class="card">
        <div class="card-title">ü¶µ Wells DVT Score</div>
        <div class="card-body">
          <div id="wellsdvt-criteria">
            <div class="criterion" onclick="toggleWellsDVT(0,1)"><input type="checkbox" id="wdvt0"><span class="criterion-label">Active cancer (treatment ongoing, within 6 months, or palliative)</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(1,1)"><input type="checkbox" id="wdvt1"><span class="criterion-label">Paralysis, paresis, or recent plaster immobilization of lower extremity</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(2,1)"><input type="checkbox" id="wdvt2"><span class="criterion-label">Bedridden &gt;3 days OR major surgery within 12 weeks requiring GA/regional anesthesia</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(3,1)"><input type="checkbox" id="wdvt3"><span class="criterion-label">Localized tenderness along deep venous system</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(4,1)"><input type="checkbox" id="wdvt4"><span class="criterion-label">Entire leg swollen</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(5,1)"><input type="checkbox" id="wdvt5"><span class="criterion-label">Calf swelling &gt;3cm vs asymptomatic leg (10cm below tibial tuberosity)</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(6,1)"><input type="checkbox" id="wdvt6"><span class="criterion-label">Pitting edema confined to symptomatic leg</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(7,1)"><input type="checkbox" id="wdvt7"><span class="criterion-label">Collateral superficial veins (non-varicose)</span><span class="criterion-pts">+1</span></div>
            <div class="criterion" onclick="toggleWellsDVT(8,-2)"><input type="checkbox" id="wdvt8"><span class="criterion-label">Alternative diagnosis at least as likely as DVT</span><span class="criterion-pts">‚àí2</span></div>
          </div>
          <div id="wellsdvt-result" class="result neutral">
            <div class="result-score">0</div>
            <div class="result-label">Select criteria above</div>
            <div class="result-action">‚Äî</div>
          </div>
          <button id="wellsdvt-copy-btn" class="copy-doc-btn" onclick="copyDoc('wellsdvt')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetWellsDVT()">Reset</button>
        </div>
      </div>

      <div class="card" style="align-self:start">
        <div class="card-title">üìä Interpretation</div>
        <div class="card-body" style="font-size:13px;line-height:1.8;color:#cbd5e1">
          <p style="margin-bottom:10px;color:#64748b;font-size:12px">Wells DVT Score interpretation:</p>
          <p><span style="color:#86efac;font-weight:700">‚â§1 ‚Äî Low probability</span><br/>DVT prevalence ~5%. D-dimer negative ‚Üí DVT excluded. D-dimer positive ‚Üí ultrasound.</p>
          <br/>
          <p><span style="color:#fde047;font-weight:700">2‚Äì6 ‚Äî Moderate probability</span><br/>DVT prevalence ~17%. Compression ultrasound. If negative + D-dimer negative ‚Üí DVT excluded.</p>
          <br/>
          <p><span style="color:#fca5a5;font-weight:700">‚â•7 ‚Äî High probability</span><br/>DVT prevalence ~53%. Compression ultrasound regardless of D-dimer. If negative, repeat in 1 week or MRI.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CANADIAN CT HEAD RULE
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-cthead" style="display:none">
    <div class="calc-grid">

      <div class="card">
        <div class="card-title">‚úÖ Eligibility Check</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:12px">Patient MUST meet ALL of the following to apply the rule:</p>
          <div id="cthead-eligibility">
            <div class="criterion" onclick="toggleCTElig(0)"><input type="checkbox" id="cte0"><span class="criterion-label">GCS score of 13‚Äì15</span></div>
            <div class="criterion" onclick="toggleCTElig(1)"><input type="checkbox" id="cte1"><span class="criterion-label">Witnessed loss of consciousness, amnesia, or confusion</span></div>
            <div class="criterion" onclick="toggleCTElig(2)"><input type="checkbox" id="cte2"><span class="criterion-label">Age ‚â• 16 years</span></div>
            <div class="criterion" onclick="toggleCTElig(3)"><input type="checkbox" id="cte3"><span class="criterion-label">Injury within last 24 hours</span></div>
            <div class="criterion" onclick="toggleCTElig(4)"><input type="checkbox" id="cte4"><span class="criterion-label">No coagulopathy / not on anticoagulants</span></div>
          </div>
          <div id="cthead-elig-result" class="result neutral" style="margin-top:12px">
            <div class="result-label">Check eligibility above</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">üî¥ High-Risk Factors <span style="font-size:12px;font-weight:400;color:#64748b">‚Äî CT if ANY present</span></div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:8px">Predicts need for neurological intervention:</p>
          <div id="cthead-high">
            <div class="criterion" onclick="toggleCTHigh(0)"><input type="checkbox" id="cth0"><span class="criterion-label">GCS &lt; 15 at 2 hours post-injury</span></div>
            <div class="criterion" onclick="toggleCTHigh(1)"><input type="checkbox" id="cth1"><span class="criterion-label">Suspected open or depressed skull fracture</span></div>
            <div class="criterion" onclick="toggleCTHigh(2)"><input type="checkbox" id="cth2"><span class="criterion-label">Any sign of basal skull fracture (hemotympanum, raccoon eyes, CSF leak, Battle's sign)</span></div>
            <div class="criterion" onclick="toggleCTHigh(3)"><input type="checkbox" id="cth3"><span class="criterion-label">Vomiting ‚â• 2 episodes</span></div>
            <div class="criterion" onclick="toggleCTHigh(4)"><input type="checkbox" id="cth4"><span class="criterion-label">Age ‚â• 65</span></div>
          </div>
          <div id="cthead-high-result" class="result neutral" style="margin-top:12px">
            <div class="result-label">Check factors above</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">üü° Medium-Risk Factors <span style="font-size:12px;font-weight:400;color:#64748b">‚Äî CT if ANY present</span></div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:8px">Predicts brain injury on CT:</p>
          <div id="cthead-med">
            <div class="criterion" onclick="toggleCTMed(0)"><input type="checkbox" id="ctm0"><span class="criterion-label">Amnesia before impact ‚â• 30 minutes</span></div>
            <div class="criterion" onclick="toggleCTMed(1)"><input type="checkbox" id="ctm1"><span class="criterion-label">Dangerous mechanism (pedestrian struck by MVC, ejected, fall &gt;3 feet or 5 stairs)</span></div>
          </div>
          <div id="cthead-med-result" class="result neutral" style="margin-top:12px">
            <div class="result-label">Check factors above</div>
          </div>
        </div>
      </div>

      <div class="card" style="align-self:start">
        <div class="card-title">üìã Overall Recommendation</div>
        <div class="card-body">
          <div id="cthead-overall" class="result neutral">
            <div class="result-label">Complete eligibility + factors above</div>
            <div class="result-action">Canadian CT Head Rule applies to minor head injury (GCS 13‚Äì15) with LOC, amnesia, or confusion.</div>
          </div>
          <button id="cthead-copy-btn" class="copy-doc-btn" onclick="copyDoc('cthead')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetCTHead()">Reset All</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">üß† New Orleans Criteria (Adult Minor Head Injury)</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:10px">
            For GCS 15 with LOC/amnesia/disorientation. If any present ‚Üí consider CT.
          </p>
          <ul style="margin-left:18px;color:#cbd5e1;line-height:1.8;font-size:13px">
            <li>Headache</li>
            <li>Vomiting</li>
            <li>Age &gt; 60</li>
            <li>Drug/alcohol intoxication</li>
            <li>Persistent anterograde amnesia</li>
            <li>Visible trauma above clavicles</li>
            <li>Seizure</li>
          </ul>
        </div>
      </div>

      <div class="card">
        <div class="card-title">üß† NEXUS-II (Adult Blunt Head Trauma)</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:10px">
            If any present ‚Üí consider CT.
          </p>
          <ul style="margin-left:18px;color:#cbd5e1;line-height:1.8;font-size:13px">
            <li>Evidence of significant skull fracture</li>
            <li>Scalp hematoma</li>
            <li>Neurologic deficit</li>
            <li>Altered level of alertness</li>
            <li>Abnormal behavior</li>
            <li>Coagulopathy</li>
            <li>Persistent vomiting</li>
            <li>Age ‚â• 65</li>
          </ul>
        </div>
      </div>

    </div>
  </div>



  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SOFT TISSUE & SEPSIS
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CENTOR / MCISAAC (HEDIS PHARYNGITIS)
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-centor" style="display:none">
    <div class="calc-grid">
      <div class="card">
        <div class="card-title">ü¶† Strep Pharyngitis ‚Äî Centor / McIsaac</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:12px">
            Decision-support only. Score applies to patients with symptoms consistent with acute pharyngitis.
          </p>

          <div class="criterion"><input type="checkbox" id="centor-exudate" onchange="calcCentor()">
            <span class="criterion-label">Tonsillar exudates</span><span class="criterion-pts">+1</span></div>

          <div class="criterion"><input type="checkbox" id="centor-nodes" onchange="calcCentor()">
            <span class="criterion-label">Tender anterior cervical adenopathy</span><span class="criterion-pts">+1</span></div>

          <div class="criterion"><input type="checkbox" id="centor-fever" onchange="calcCentor()">
            <span class="criterion-label">Fever (‚â•38¬∞C / 100.4¬∞F)</span><span class="criterion-pts">+1</span></div>

          <div class="criterion"><input type="checkbox" id="centor-nocough" onchange="calcCentor()">
            <span class="criterion-label">No cough</span><span class="criterion-pts">+1</span></div>

          <div class="radio-group" style="margin-top:10px">
            <label>Age adjustment (McIsaac)</label>
            <div class="radio-option"><input type="radio" name="centor-age" value="1" onchange="calcCentor()">
              <span>3‚Äì14 years</span><span class="radio-pts">+1</span></div>
            <div class="radio-option"><input type="radio" name="centor-age" value="0" onchange="calcCentor()">
              <span>15‚Äì44 years</span><span class="radio-pts">0</span></div>
            <div class="radio-option"><input type="radio" name="centor-age" value="-1" onchange="calcCentor()">
              <span>‚â•45 years</span><span class="radio-pts">-1</span></div>
          </div>

          <div id="centor-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Select criteria</div>
            <div class="result-action">Tip: use RADT/NAAT per local workflow. Consider backup culture in kids if RADT negative.</div>
          </div>

          <button id="centor-reset" class="reset-btn" onclick="resetCentor()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PECARN HEAD INJURY
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-pecarn" style="display:none">
    <div class="calc-grid">
      <div class="card">
        <div class="card-title">üßí PECARN Pediatric Head Injury (CT Decision Support)</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:12px">
            For minor blunt head trauma, GCS 14‚Äì15. Decision-support only ‚Äî apply clinical judgment and local protocol.
          </p>

          <div class="radio-group">
            <label>Age group</label>
            <div class="radio-option"><input type="radio" name="pecarn-age" value="lt2" onchange="renderPecarn();calcPecarn()">
              <span>&lt; 2 years</span></div>
            <div class="radio-option"><input type="radio" name="pecarn-age" value="ge2" onchange="renderPecarn();calcPecarn()">
              <span>‚â• 2 years</span></div>
          </div>

          <div id="pecarn-criteria-wrap"></div>

          <div id="pecarn-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Select age group + criteria</div>
            <div class="result-action">Output is a guidance band (CT vs Observe vs No CT). Not a mandate.</div>
          </div>

          <button id="pecarn-copy-btn" class="copy-doc-btn" onclick="copyDoc(\'pecarn\')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetPecarn()">Reset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PEDS FEVER
  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="calc-pedsfever" style="display:none">
    <div class="calc-grid">
      <div class="card">
        <div class="card-title">üå°Ô∏è Pediatric Fever ‚Äî CA FIRST (Quick Access)</div>
        <div class="card-body">
          <p style="font-size:12px;color:#64748b;margin-bottom:12px">
            This is a shortcut into the full Peds Fever protocol page used on this site.
          </p>

          <div class="result neutral" style="margin-top:0">
            <div class="result-label">Open full protocol</div>
            <div class="result-action">
              <a href="pedsfever.html" style="color:#60a5fa;text-decoration:none;font-weight:700">‚Üí Peds Fever (CA FIRST) Page</a><br/>
              Includes: exclusions, age-stratified workup (0‚Äì28d, 29‚Äì60d, 61‚Äì90d, 3‚Äì36mo), IM marker table, and disposition guidance.
            </div>
          </div>

          <div style="margin-top:14px;font-size:12px;color:#94a3b8;line-height:1.7">
            <strong style="color:#f1f5f9">Reminder:</strong> Always confirm age in days, prematurity, and immunization status; apply shared decision-making and local pathways.
          </div>
        </div>
      </div>
    </div>
  </div>
<div id="calc-softtissue" style="display:none">
    <div class="calc-grid">

      <!-- LRINEC -->
      <div class="card">
        <div class="card-title">ü©∏ LRINEC (Necrotizing Soft Tissue Infection)</div>
        <div class="card-body">

          <p style="font-size:12px;color:#64748b;margin-bottom:12px">
            LRINEC is a risk stratification/documentation tool ‚Äî limited sensitivity (do NOT use to rule out nec fasc).
          </p>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">CRP (mg/L)</label>
              <input id="lr-crp" type="number" inputmode="decimal" placeholder="e.g., 180"
                oninput="calcLRINEC()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">WBC (√ó10¬≥/¬µL)</label>
              <input id="lr-wbc" type="number" inputmode="decimal" placeholder="e.g., 22"
                oninput="calcLRINEC()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Hgb (g/dL)</label>
              <input id="lr-hgb" type="number" inputmode="decimal" placeholder="e.g., 12.5"
                oninput="calcLRINEC()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Na (mmol/L)</label>
              <input id="lr-na" type="number" inputmode="decimal" placeholder="e.g., 131"
                oninput="calcLRINEC()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Creatinine (mg/dL)</label>
              <input id="lr-cr" type="number" inputmode="decimal" placeholder="e.g., 2.1"
                oninput="calcLRINEC()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Glucose (mg/dL)</label>
              <input id="lr-glu" type="number" inputmode="decimal" placeholder="e.g., 220"
                oninput="calcLRINEC()" class="input"/>
            </div>
          </div>

          <div id="lrinec-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Enter labs above</div>
            <div class="result-action">LRINEC: ‚â§5 low, 6‚Äì7 intermediate, ‚â•8 high (risk stratification only).</div>
          </div>

          <button id="lrinec-copy-btn" class="copy-doc-btn" onclick="copyDoc('lrinec')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetLRINEC()">Reset</button>
        </div>
      </div>

      <!-- FGSI -->
      <div class="card">
        <div class="card-title">‚ö†Ô∏è Fournier‚Äôs Gangrene Severity Index (FGSI)</div>
        <div class="card-body">

          <p style="font-size:12px;color:#64748b;margin-bottom:12px">
            Prognostic score (mortality risk / ICU justification). Commonly cited: FGSI &gt; 9 ‚Üí high mortality risk.
          </p>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Temp (¬∞C)</label>
              <input id="fg-temp" type="number" inputmode="decimal" placeholder="e.g., 39.2" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">HR</label>
              <input id="fg-hr" type="number" inputmode="numeric" placeholder="e.g., 145" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">RR</label>
              <input id="fg-rr" type="number" inputmode="numeric" placeholder="e.g., 28" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Na (mmol/L)</label>
              <input id="fg-na" type="number" inputmode="decimal" placeholder="e.g., 128" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">K (mmol/L)</label>
              <input id="fg-k" type="number" inputmode="decimal" placeholder="e.g., 5.7" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Creatinine (mg/dL)</label>
              <input id="fg-cr" type="number" inputmode="decimal" placeholder="e.g., 2.3" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">Hct (%)</label>
              <input id="fg-hct" type="number" inputmode="decimal" placeholder="e.g., 28" oninput="calcFGSI()" class="input"/>
            </div>
            <div><label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">WBC (√ó10¬≥/¬µL)</label>
              <input id="fg-wbc" type="number" inputmode="decimal" placeholder="e.g., 24" oninput="calcFGSI()" class="input"/>
            </div>
            <div style="grid-column:1 / -1">
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">HCO‚ÇÉ (mmol/L, venous)</label>
              <input id="fg-hco3" type="number" inputmode="decimal" placeholder="e.g., 17" oninput="calcFGSI()" class="input"/>
            </div>
          </div>

          <div id="fgsi-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Enter vitals/labs above</div>
            <div class="result-action">FGSI is prognostic. A commonly used threshold is &gt;9 (high mortality risk).</div>
          </div>

          <button id="fgsi-copy-btn" class="copy-doc-btn" onclick="copyDoc('fgsi')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetFGSI()">Reset</button>
        </div>
      </div>

      <!-- SIRS -->
      <div class="card">
        <div class="card-title">üå°Ô∏è SIRS</div>
        <div class="card-body">
          <div id="sirs-criteria">
            <div class="criterion" onclick="toggleSIRS(0)"><input type="checkbox" id="sirs0"><span class="criterion-label">Temp &gt;38¬∞C or &lt;36¬∞C</span></div>
            <div class="criterion" onclick="toggleSIRS(1)"><input type="checkbox" id="sirs1"><span class="criterion-label">HR &gt;90</span></div>
            <div class="criterion" onclick="toggleSIRS(2)"><input type="checkbox" id="sirs2"><span class="criterion-label">RR &gt;20 or PaCO‚ÇÇ &lt;32</span></div>
            <div class="criterion" onclick="toggleSIRS(3)"><input type="checkbox" id="sirs3"><span class="criterion-label">WBC &gt;12 or &lt;4 or bands &gt;10%</span></div>
          </div>
          <div id="sirs-result" class="result neutral">
            <div class="result-score">0</div>
            <div class="result-label">Select criteria above</div>
            <div class="result-action">‚â•2 suggests systemic inflammatory response.</div>
          </div>
          <button id="sirs-copy-btn" class="copy-doc-btn" onclick="copyDoc('sirs')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetSIRS()">Reset</button>
        </div>
      </div>

      <!-- qSOFA -->
      <div class="card">
        <div class="card-title">üß† qSOFA</div>
        <div class="card-body">
          <div id="qsofa-criteria">
            <div class="criterion" onclick="toggleQSOFA(0)"><input type="checkbox" id="qsofa0"><span class="criterion-label">RR ‚â•22</span></div>
            <div class="criterion" onclick="toggleQSOFA(1)"><input type="checkbox" id="qsofa1"><span class="criterion-label">SBP ‚â§100</span></div>
            <div class="criterion" onclick="toggleQSOFA(2)"><input type="checkbox" id="qsofa2"><span class="criterion-label">Altered mentation</span></div>
          </div>
          <div id="qsofa-result" class="result neutral">
            <div class="result-score">0</div>
            <div class="result-label">Select criteria above</div>
            <div class="result-action">‚â•2 associated with higher mortality risk ‚Üí escalate care.</div>
          </div>
          <button id="qsofa-copy-btn" class="copy-doc-btn" onclick="copyDoc('qsofa')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetQSOFA()">Reset</button>
        </div>
      </div>

      <!-- Shock Index -->
      <div class="card">
        <div class="card-title">üí• Shock Index</div>
        <div class="card-body">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">HR</label>
              <input id="si-hr" type="number" inputmode="numeric" placeholder="e.g., 120" oninput="calcShockIndex()" class="input"/>
            </div>
            <div>
              <label style="display:block;font-size:12px;color:#64748b;font-weight:600;margin-bottom:6px">SBP</label>
              <input id="si-sbp" type="number" inputmode="numeric" placeholder="e.g., 95" oninput="calcShockIndex()" class="input"/>
            </div>
          </div>
          <div id="si-result" class="result neutral">
            <div class="result-score">‚Äî</div>
            <div class="result-label">Enter HR + SBP</div>
            <div class="result-action">Shock Index = HR/SBP. &gt;0.9 is concerning for occult shock in many contexts.</div>
          </div>
          <button id="si-copy-btn" class="copy-doc-btn" onclick="copyDoc('shock')">üìã Copy Documentation</button>
          <button class="reset-btn" onclick="resetShockIndex()">Reset</button>
        </div>
      </div>

    </div>
  </div>

</main>

<script>
// ‚îÄ‚îÄ CALC TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showCalc(id) {
  const calcs = ['wellspe','heart','wellsdvt','cthead','pecarn','centor','pedsfever','softtissue'];

  calcs.forEach(c => {
    const el = document.getElementById('calc-'+c);
    if (el) el.style.display = (c === id) ? '' : 'none';
  });

  const tabs = document.querySelectorAll('.calc-tab');
  tabs.forEach((btn, i) => btn.classList.toggle('active', calcs[i] === id));
}

// ‚îÄ‚îÄ COPY DOCUMENTATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyText(text, btn){
  const onSuccess = ()=>{
    const orig = btn ? btn.innerHTML : null;
    if(btn){
      btn.innerHTML = '‚úÖ Copied!';
      btn.classList.add('copied');
      setTimeout(()=>{ btn.innerHTML = orig; btn.classList.remove('copied'); }, 2200);
    }
  };

  const fallback = ()=>{
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position='fixed';
    ta.style.left='-9999px';
    ta.style.top='0';
    ta.setAttribute('readonly','');
    document.body.appendChild(ta);
    ta.select();
    ta.setSelectionRange(0, ta.value.length);
    try{ document.execCommand('copy'); }catch(e){}
    document.body.removeChild(ta);
    onSuccess();
  };

  if(navigator.clipboard && window.isSecureContext){
    navigator.clipboard.writeText(text).then(onSuccess).catch(fallback);
  } else {
    fallback();
  }
}

function copyDoc(type) {
  let text = '';
  const btn = document.getElementById(type+'-copy-btn');

  if (type === 'perc') {
    const any = percChecked.some(Boolean);
    if (!any) {
      text = 'PERC Rule (Pulmonary Embolism Rule-out Criteria) applied. Pulmonary embolism ruled out utilizing the PERC rule. Pre-test probability was low by clinical gestalt. All 8 PERC criteria were absent: age <50, heart rate <100 bpm, SpO2 ‚â•95% on room air, no unilateral leg swelling, no hemoptysis, no recent surgery or trauma within 4 weeks, no prior PE or DVT, and no exogenous estrogen use. PERC rule satisfied ‚Äî no further workup for PE indicated per validated clinical decision rule (Kline et al., Ann Emerg Med 2004).';
    } else {
      const present = ['age ‚â•50','HR ‚â•100 bpm','SpO2 <95%','unilateral leg swelling','hemoptysis','recent surgery/trauma','prior PE or DVT','hormone use'].filter((_,i)=>percChecked[i]);
      text = 'PERC rule criteria not fully satisfied. The following PERC criteria were present: ' + present.join(', ') + '. Pre-test probability insufficient to rule out PE by PERC criteria alone. Wells PE score calculated and workup initiated accordingly.';
    }
  }

  else if (type === 'wellspe') {
    const score = wpeChecked.reduce((s,c,i)=>s+(c?wpePoints[i]:0),0);
    const labels = ['Clinical signs/symptoms of DVT','PE is #1 or equally likely diagnosis','HR >100 bpm','Immobilization ‚â•3 days or surgery in past 4 weeks','Prior PE or DVT history','Hemoptysis','Active malignancy'];
    const cats = labels.filter((_,i)=>wpeChecked[i]);
    const breakdown = labels.map((l,i)=>wpeChecked[i] ? `${l} (+${wpePoints[i]})` : null).filter(Boolean);
    let risk, plan;
    if(score<=1){risk='low probability';plan='Pre-test probability low. If PERC criteria satisfied, no further PE workup indicated. If PERC not satisfied, D-dimer obtained ‚Äî if negative, PE excluded.';}
    else if(score<=6){risk='moderate probability';plan='D-dimer obtained. If elevated, CT pulmonary angiography performed to evaluate for PE.';}
    else{risk='high probability';plan='CT pulmonary angiography pursued directly. Empiric anticoagulation considered while awaiting imaging given high pre-test probability.';}
    text = 'Wells Score (PE) calculated for pulmonary embolism risk stratification. Total Wells PE score: ' + score + ' ‚Äî ' + risk + '. ' + (breakdown.length ? 'Score breakdown: ' + breakdown.join('; ') + '. ' : 'No Wells criteria met. ') + plan;
  }

  else if (type === 'heart') {
    const score = ['h','e','a','r','t'].reduce((s,k)=>s+(heartScores[k]??0),0);
    const filled = ['h','e','a','r','t'].every(k=>heartScores[k]!==null);
    if (!filled) { alert('Please complete all 5 HEART score categories first.'); return; }
    let risk, plan;
    const hDesc = ['slightly suspicious (mostly non-specific)','moderately suspicious (atypical ACS features)','highly suspicious (classic anginal)'][heartScores['h']];
    const eDesc = ['normal','non-specific repolarization disturbance','significant ST deviation'][heartScores['e']];
    const aDesc = ['<45','45‚Äì64','‚â•65'][heartScores['a']];
    const rDesc = ['no known risk factors','1‚Äì2 cardiovascular risk factors','‚â•3 risk factors or known CAD/atherosclerotic disease'][heartScores['r']];
    const tDesc = ['‚â§1√ó ULN','1‚Äì3√ó ULN','>3√ó ULN'][heartScores['t']];
    if(score<=3){risk='low risk';plan='HEART score in low-risk range. Serial troponins negative and non-trending. Shared decision-making discussion held with patient regarding low-risk disposition. Patient discharged with cardiology follow-up and return precautions.';}
    else if(score<=6){risk='moderate risk';plan='HEART score in moderate-risk range. Cardiology notified. Observation, further risk stratification with stress testing, or cardiology-guided management plan initiated.';}
    else{risk='high risk';plan='HEART score in high-risk range. Cardiology consulted for early invasive strategy. Admission planned.';}
    text = 'HEART score calculated for chest pain risk stratification. Total HEART score: ' + score + '/10 ‚Äî ' + risk + '. Score breakdown: History ' + heartScores['h'] + '/2 (' + hDesc + '); EKG ' + heartScores['e'] + '/2 (' + eDesc + '); Age ' + heartScores['a'] + '/2 (' + aDesc + '); Risk factors ' + heartScores['r'] + '/2 (' + rDesc + '); Troponin ' + heartScores['t'] + '/2 (' + tDesc + '). ' + plan;
  }

  else if (type === 'wellsdvt') {
    const score = wdvtChecked.reduce((s,c,i)=>s+(c?wdvtPoints[i]:0),0);
    const labels = ['Active cancer','Paralysis/paresis/recent immobilization of lower extremity','Bedridden >3 days or major surgery within 12 weeks','Localized tenderness along deep venous system','Entire leg swollen','Calf swelling >3 cm vs contralateral','Pitting edema confined to symptomatic leg','Collateral superficial veins (non-varicose)','Alternative diagnosis at least as likely (‚àí2)'];
    const cats = labels.filter((_,i)=>wdvtChecked[i]);
    const breakdown = labels.map((l,i)=>wdvtChecked[i] ? `${l} (${wdvtPoints[i]>0?`+${wdvtPoints[i]}`:wdvtPoints[i]})` : null).filter(Boolean);
    let risk, plan;
    if(score<=1){risk='low probability';plan='D-dimer obtained. If negative, DVT excluded per validated algorithm. If positive, compression ultrasound of lower extremity obtained.';}
    else if(score<=6){risk='moderate probability';plan='Compression ultrasound of lower extremity obtained. If negative and D-dimer negative, DVT excluded.';}
    else{risk='high probability';plan='Compression ultrasound of lower extremity obtained regardless of D-dimer result given high pre-test probability. If negative, repeat ultrasound in 1 week or MRI considered.';}
    text = 'Wells DVT criteria applied for deep vein thrombosis risk stratification. Wells DVT score: ' + score + ' ‚Äî ' + risk + '. ' + (cats.length ? 'Criteria present: ' + cats.join(', ') + '. ' : 'No Wells DVT criteria met. ') + plan;
  }

  else if (type === 'cthead') {
    const eligible = cteChecked.every(Boolean);
    const anyHigh = cthChecked.some(Boolean);
    const anyMed = ctmChecked.some(Boolean);
    const highPresent = ['GCS <15 at 2h post-injury','suspected open/depressed skull fracture','signs of basal skull fracture','vomiting ‚â•2 episodes','age ‚â•65'].filter((_,i)=>cthChecked[i]);
    const medPresent = ['amnesia before impact ‚â•30 min','dangerous mechanism'].filter((_,i)=>ctmChecked[i]);
    if (!eligible) {
      text = 'Canadian CT Head Rule evaluated. Patient does not meet all eligibility criteria for the rule ‚Äî CT head obtained based on clinical judgment.';
    } else if (!anyHigh && !anyMed) {
      text = 'Canadian CT Head Rule applied to this eligible patient with minor head injury (GCS 13‚Äì15, witnessed LOC/amnesia/confusion). No high-risk factors identified (no GCS <15 at 2h, no open/depressed fracture, no basal skull fracture signs, no vomiting ‚â•2 episodes, age <65). No medium-risk factors identified (no amnesia ‚â•30 min before impact, no dangerous mechanism). Per Canadian CT Head Rule, CT head not required. Patient observed without neurological deterioration. Concussion precautions and return precautions provided (Stiell et al., Lancet 2001).';
    } else {
      const factors = [...highPresent.map(f=>'[HIGH RISK] '+f), ...medPresent.map(f=>'[MED RISK] '+f)];
      text = 'Canadian CT Head Rule applied. Patient eligible (GCS 13‚Äì15, LOC/amnesia/confusion, age ‚â•16, injury within 24h, no coagulopathy). CT head indicated based on the following criteria: ' + factors.join('; ') + '. CT head obtained.';
    }
  }

  if (!text) return;
  
  else if (type === 'lrinec') {
    const scoreEl = document.querySelector('#lrinec-result .result-score');
    const score = scoreEl ? scoreEl.textContent : '‚Äî';
    text = `LRINEC score calculated as ${score}. While LRINEC has limited sensitivity and should NOT be used to rule out necrotizing soft tissue infection, an elevated score increases concern and supports early surgical consultation and escalation of care when clinically indicated.`;
  }
  else if (type === 'fgsi') {
    const scoreEl = document.querySelector('#fgsi-result .result-score');
    const score = scoreEl ? scoreEl.textContent : '‚Äî';
    text = `Fournier‚Äôs Gangrene Severity Index (FGSI) calculated as ${score}. FGSI is a prognostic severity tool and supports ICU-level care and aggressive management when elevated (commonly cited threshold >9 associated with high mortality risk).`;
  }
  else if (type === 'sirs') {
    const n = sirsChecked.filter(Boolean).length;
    text = `SIRS criteria assessed: ${n}/4 positive. Findings support systemic inflammatory response in the appropriate clinical context; management and disposition based on overall clinical picture and suspected source.`;
  }
  else if (type === 'qsofa') {
    const n = qsofaChecked.filter(Boolean).length;
    text = `qSOFA calculated: ${n}/3. qSOFA is a mortality risk screen; elevated score supports escalation of care and close monitoring in appropriate clinical context.`;
  }
  else if (type === 'shock') {
    const scoreEl = document.querySelector('#si-result .result-score');
    const si = scoreEl ? scoreEl.textContent : '‚Äî';
    text = `Shock Index calculated (HR/SBP): ${si}. Elevated shock index can suggest occult shock physiology; resuscitation and escalation based on perfusion status and clinical context.`;
  }


else if (type === 'centor') {
    const score = centorState.score;
    if (score === null) { alert('Select Centor/McIsaac criteria first.'); return; }
    const breakdown = centorState.breakdown;
    const plan = centorState.plan;
    text = `Centor/McIsaac Score (Strep Pharyngitis) calculated. Total score: ${score}. ` +
           (breakdown.length ? `Score breakdown: ${breakdown.join('; ')}. ` : '') +
           plan;
  }

  else if (type === 'pecarn') {
    if(!pecarnState.ageGroup){ alert('Select PECARN age group first.'); return; }
    const rec = pecarnState.recommendation;
    const ageLabel = pecarnState.ageGroup === 'lt2' ? '<2 years' : '‚â•2 years';
    const breakdown = pecarnState.checked.map(x=>`‚Ä¢ ${x}`).join(' ');
    text = `PECARN Pediatric Head Injury Rule applied (${ageLabel}, GCS 14‚Äì15, minor blunt head trauma). ` +
           (pecarnState.checked.length ? `Risk features present: ${pecarnState.checked.join('; ')}. ` : 'No PECARN risk features selected. ') +
           `Recommendation: ${rec}. Clinical judgment and shared decision-making applied as appropriate.`;
  }

  copyText(text, btn);
}

let centorState = {score:null, breakdown:[], plan:''};
let pecarnState = {ageGroup:null, checked:[], recommendation:''};

// ‚îÄ‚îÄ PERC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const percChecked = Array(8).fill(false);
let percTouched = false;
function togglePerc(i) {
  percTouched = true;
  percChecked[i] = !percChecked[i];
  document.getElementById('perc'+i).checked = percChecked[i];
  updatePerc();
}
function updatePerc() {
  const any = percChecked.some(Boolean);
  const r = document.getElementById('perc-result');
  const btn = document.getElementById('perc-copy-btn');
  if (!percTouched) {
    r.className='result neutral';
    r.innerHTML='<div class="result-label">Check criteria above</div><div class="result-action">All 8 must be absent to rule out PE without further testing.</div>';
    btn.classList.remove('show'); return;
  }
  btn.classList.add('show');
  if (!any) {
    r.className='result low';
    r.innerHTML='<div class="result-label">‚úì PERC Negative ‚Äî PE Ruled Out</div><div class="result-action">All 8 PERC criteria absent. If pre-test probability is low (Wells &lt;2), no further workup needed for PE.</div>';
  } else {
    r.className='result high';
    r.innerHTML='<div class="result-label">‚ö†Ô∏è PERC Positive ‚Äî Cannot Rule Out PE</div><div class="result-action">One or more PERC criteria present. Proceed with Wells PE score + D-dimer or CT-PA as indicated.</div>';
  }
}
function resetPerc() {
  percTouched = false; percChecked.fill(false);
  for(let i=0;i<8;i++) document.getElementById('perc'+i).checked=false;
  document.getElementById('perc-copy-btn').classList.remove('show');
  updatePerc();
}

// ‚îÄ‚îÄ WELLS PE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const wpePoints = [3,3,1.5,1.5,1.5,1,1];
const wpeChecked = Array(7).fill(false);
let wpeTouched = false;
function toggleWellsPE(i) {
  wpeTouched = true;
  wpeChecked[i] = !wpeChecked[i];
  document.getElementById('wpe'+i).checked = wpeChecked[i];
  updateWellsPE();
}
function updateWellsPE() {
  let score = 0;
  wpeChecked.forEach((c,i) => { if(c) score += wpePoints[i]; });
  const r = document.getElementById('wellspe-result');
  const btn = document.getElementById('wellspe-copy-btn');
  if (!wpeTouched) { btn.classList.remove('show'); return; }
  btn.classList.add('show');
  let cls, label, action;
  if(score<=1){cls='low';label='Low Probability (Wells ‚â§1)';action='PE prevalence ~1.3%. Apply PERC ‚Äî if all 8 criteria absent ‚Üí PE excluded. If PERC positive ‚Üí D-dimer.';}
  else if(score<=6){cls='moderate';label='Moderate Probability (Wells 2‚Äì6)';action='PE prevalence ~16%. D-dimer recommended. If elevated ‚Üí CT pulmonary angiography.';}
  else{cls='high';label='High Probability (Wells ‚â•7)';action='PE prevalence ~41%. Proceed directly to CT-PA. Consider empiric anticoagulation while awaiting imaging.';}
  r.className='result '+cls;
  r.innerHTML=`<div class="result-score">${score}</div><div class="result-label">${label}</div><div class="result-action">${action}</div>`;
}
function resetWellsPE() {
  wpeTouched=false; wpeChecked.fill(false);
  for(let i=0;i<7;i++) document.getElementById('wpe'+i).checked=false;
  document.getElementById('wellspe-copy-btn').classList.remove('show');
  updateWellsPE();
}

// ‚îÄ‚îÄ HEART SCORE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const heartScores = {h:null,e:null,a:null,r:null,t:null};
function setHEART(key, val, el) {
  heartScores[key] = val;
  el.querySelector('input').checked = true;
  updateHEART();
}
function updateHEART() {
  const filled = ['h','e','a','r','t'].every(k=>heartScores[k]!==null);
  const score = ['h','e','a','r','t'].reduce((s,k)=>s+(heartScores[k]??0),0);
  const r = document.getElementById('heart-result');
  const btn = document.getElementById('heart-copy-btn');
  if (!filled) {
    r.className='result neutral';
    r.innerHTML=`<div class="result-score">${score}</div><div class="result-label">Select all 5 categories</div><div class="result-action">Complete all domains to calculate HEART score.</div>`;
    btn.classList.remove('show'); return;
  }
  btn.classList.add('show');
  let cls, label, action;
  if(score<=3){cls='low';label='Low Risk ‚Äî HEART Score '+score+'/10';action='MACE risk ~1.7%. With negative serial troponins, eligible for early discharge with outpatient cardiology follow-up. Shared decision-making discussion documented.';}
  else if(score<=6){cls='moderate';label='Moderate Risk ‚Äî HEART Score '+score+'/10';action='MACE risk ~12‚Äì17%. Observation or cardiology consult recommended. Stress testing or further risk stratification prior to discharge.';}
  else{cls='high';label='High Risk ‚Äî HEART Score '+score+'/10';action='MACE risk ~50‚Äì65%. Cardiology consulted. Admission and early invasive strategy indicated.';}
  r.className='result '+cls;
  r.innerHTML=`<div class="result-score">${score}/10</div><div class="result-label">${label}</div><div class="result-action">${action}</div>`;
}
function resetHEART() {
  ['h','e','a','r','t'].forEach(k=>heartScores[k]=null);
  document.querySelectorAll('input[name^="heart-"]').forEach(r=>r.checked=false);
  document.getElementById('heart-copy-btn').classList.remove('show');
  updateHEART();
}

// ‚îÄ‚îÄ WELLS DVT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const wdvtPoints = [1,1,1,1,1,1,1,1,-2];
const wdvtChecked = Array(9).fill(false);
let wdvtTouched = false;
function toggleWellsDVT(i) {
  wdvtTouched = true;
  wdvtChecked[i] = !wdvtChecked[i];
  document.getElementById('wdvt'+i).checked = wdvtChecked[i];
  updateWellsDVT();
}
function updateWellsDVT() {
  let score = 0;
  wdvtChecked.forEach((c,i) => { if(c) score += wdvtPoints[i]; });
  const r = document.getElementById('wellsdvt-result');
  const btn = document.getElementById('wellsdvt-copy-btn');
  if (!wdvtTouched) { btn.classList.remove('show'); return; }
  btn.classList.add('show');
  let cls, label, action;
  if(score<=1){cls='low';label='Low Probability (Wells ‚â§1)';action='DVT prevalence ~5%. D-dimer negative ‚Üí DVT excluded. D-dimer positive ‚Üí compression ultrasound.';}
  else if(score<=6){cls='moderate';label='Moderate Probability (Wells 2‚Äì6)';action='DVT prevalence ~17%. Compression ultrasound recommended. Negative US + negative D-dimer ‚Üí DVT excluded.';}
  else{cls='high';label='High Probability (Wells ‚â•7)';action='DVT prevalence ~53%. Compression ultrasound regardless of D-dimer. If negative, consider repeat in 1 week or MRI.';}
  r.className='result '+cls;
  r.innerHTML=`<div class="result-score">${score}</div><div class="result-label">${label}</div><div class="result-action">${action}</div>`;
}
function resetWellsDVT() {
  wdvtTouched=false; wdvtChecked.fill(false);
  for(let i=0;i<9;i++) document.getElementById('wdvt'+i).checked=false;
  document.getElementById('wellsdvt-copy-btn').classList.remove('show');
  updateWellsDVT();
}

// ‚îÄ‚îÄ CANADIAN CT HEAD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const cteChecked = Array(5).fill(false);
const cthChecked = Array(5).fill(false);
const ctmChecked = Array(2).fill(false);
function toggleCTElig(i){cteChecked[i]=!cteChecked[i];document.getElementById('cte'+i).checked=cteChecked[i];updateCTHead();}
function toggleCTHigh(i){cthChecked[i]=!cthChecked[i];document.getElementById('cth'+i).checked=cthChecked[i];updateCTHead();}
function toggleCTMed(i){ctmChecked[i]=!ctmChecked[i];document.getElementById('ctm'+i).checked=ctmChecked[i];updateCTHead();}
function updateCTHead() {
  const eligible = cteChecked.every(Boolean);
  const er = document.getElementById('cthead-elig-result');
  if(cteChecked.every(c=>!c)){er.className='result neutral';er.innerHTML='<div class="result-label">Check eligibility above</div>';}
  else if(eligible){er.className='result low';er.innerHTML='<div class="result-label">‚úì Rule Applicable</div>';}
  else{er.className='result moderate';er.innerHTML='<div class="result-label">‚ö†Ô∏è Eligibility criteria incomplete</div>';}
  const anyHigh=cthChecked.some(Boolean);
  const hr=document.getElementById('cthead-high-result');
  hr.className=anyHigh?'result high':'result low';
  hr.innerHTML=anyHigh?'<div class="result-label">‚ö†Ô∏è High-risk factor present ‚Üí CT indicated</div>':'<div class="result-label">‚úì No high-risk factors</div>';
  const anyMed=ctmChecked.some(Boolean);
  const mr=document.getElementById('cthead-med-result');
  mr.className=anyMed?'result moderate':'result low';
  mr.innerHTML=anyMed?'<div class="result-label">‚ö†Ô∏è Medium-risk factor present ‚Üí CT indicated</div>':'<div class="result-label">‚úì No medium-risk factors</div>';
  const overall=document.getElementById('cthead-overall');
  const btn=document.getElementById('cthead-copy-btn');
  if(!eligible){
    overall.className='result neutral';
    overall.innerHTML='<div class="result-label">Complete eligibility check first</div><div class="result-action">Rule applies to minor head injury: GCS 13‚Äì15, LOC/amnesia/confusion, age ‚â•16, injury within 24h, no coagulopathy.</div>';
    btn.classList.remove('show');
  } else if(anyHigh||anyMed){
    overall.className='result high';
    overall.innerHTML='<div class="result-label">üî¥ CT Head Indicated</div><div class="result-action">'+(anyHigh?'High-risk factor(s) present ‚Äî CT for possible neurological intervention. ':'')+(anyMed?'Medium-risk factor(s) present ‚Äî CT to detect brain injury.':'')+'</div>';
    btn.classList.add('show');
  } else {
    overall.className='result low';
    overall.innerHTML='<div class="result-label">‚úì CT Not Required by Canadian CT Head Rule</div><div class="result-action">No high- or medium-risk factors in eligible patient. CT not indicated per validated rule. Apply clinical judgment.</div>';
    btn.classList.add('show');
  }
}
function resetCTHead(){
  cteChecked.fill(false);cthChecked.fill(false);ctmChecked.fill(false);
  for(let i=0;i<5;i++){document.getElementById('cte'+i).checked=false;document.getElementById('cth'+i).checked=false;}
  for(let i=0;i<2;i++)document.getElementById('ctm'+i).checked=false;
  document.getElementById('cthead-copy-btn').classList.remove('show');
  updateCTHead();
}

// ‚îÄ‚îÄ SOFT TISSUE & SEPSIS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setResult(elId, cls, score, label, action){
  const el = document.getElementById(elId);
  if(!el) return;
  el.className = 'result ' + cls;
  el.innerHTML = `<div class="result-score">${score}</div><div class="result-label">${label}</div><div class="result-action">${action}</div>`;
}

// LRINEC: CRP‚â•150=4; WBC 15‚Äì25=1, >25=2; Hgb 11‚Äì13.5=1, <11=2; Na<135=2; Cr>1.6=2; Glu>180=1
function calcLRINEC() {
  const crp = parseFloat(document.getElementById('lr-crp').value);
  const wbc = parseFloat(document.getElementById('lr-wbc').value);
  const hgb = parseFloat(document.getElementById('lr-hgb').value);
  const na  = parseFloat(document.getElementById('lr-na').value);
  const cr  = parseFloat(document.getElementById('lr-cr').value);
  const glu = parseFloat(document.getElementById('lr-glu').value);

  const vals = [crp,wbc,hgb,na,cr,glu];
  const filledAny = vals.some(v => !Number.isNaN(v));
  const btn = document.getElementById('lrinec-copy-btn');

  if (!filledAny) {
    setResult('lrinec-result', 'neutral', '‚Äî', 'Enter labs above', 'LRINEC: ‚â§5 low, 6‚Äì7 intermediate, ‚â•8 high (risk stratification only).');
    if(btn) btn.classList.remove('show');
    return;
  }

  let score = 0;
  if (!Number.isNaN(crp) && crp >= 150) score += 4;
  if (!Number.isNaN(wbc)) {
    if (wbc > 25) score += 2;
    else if (wbc >= 15) score += 1;
  }
  if (!Number.isNaN(hgb)) {
    if (hgb < 11) score += 2;
    else if (hgb <= 13.5) score += 1;
  }
  if (!Number.isNaN(na) && na < 135) score += 2;
  if (!Number.isNaN(cr) && cr > 1.6) score += 2;
  if (!Number.isNaN(glu) && glu > 180) score += 1;

  let cls='low', label='Low risk', action='LRINEC ‚â§5. Do NOT use to rule out ‚Äî correlate clinically; early surgical consult if concern.';
  if (score >= 8) { cls='high'; label='High risk'; action='LRINEC ‚â•8. High concern for NSTI (risk stratification only). Consider emergent surgery consult + imaging if it will not delay OR.'; }
  else if (score >= 6) { cls='moderate'; label='Intermediate risk'; action='LRINEC 6‚Äì7. Consider imaging + early surgery consult if clinically concerning.'; }

  setResult('lrinec-result', cls, String(score), label, action);
  if(btn) btn.classList.add('show');
}

function resetLRINEC() {
  ['lr-crp','lr-wbc','lr-hgb','lr-na','lr-cr','lr-glu'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  calcLRINEC();
}

// FGSI scoring bins (0‚Äì4 each)
function fgRangeScore(val, ranges) {
  if (Number.isNaN(val)) return null;
  for (const r of ranges) {
    if (r.min !== null && val < r.min) continue;
    if (r.max !== null && val > r.max) continue;
    return r.score;
  }
  return 0;
}

function calcFGSI() {
  const t = parseFloat(document.getElementById('fg-temp').value);
  const hr = parseFloat(document.getElementById('fg-hr').value);
  const rr = parseFloat(document.getElementById('fg-rr').value);
  const na = parseFloat(document.getElementById('fg-na').value);
  const k  = parseFloat(document.getElementById('fg-k').value);
  const cr = parseFloat(document.getElementById('fg-cr').value);
  const hct = parseFloat(document.getElementById('fg-hct').value);
  const wbc = parseFloat(document.getElementById('fg-wbc').value);
  const hco3 = parseFloat(document.getElementById('fg-hco3').value);

  const vals = [t,hr,rr,na,k,cr,hct,wbc,hco3];
  const filledAny = vals.some(v => !Number.isNaN(v));
  const btn = document.getElementById('fgsi-copy-btn');

  if (!filledAny) {
    setResult('fgsi-result', 'neutral', '‚Äî', 'Enter vitals/labs above', 'FGSI is prognostic. A commonly used threshold is >9 (high mortality risk).');
    if(btn) btn.classList.remove('show');
    return;
  }

  const tempScore = fgRangeScore(t, [
    {min:41.0, max:null, score:4},
    {min:39.0, max:40.9, score:3},
    {min:38.5, max:38.9, score:1},
    {min:36.0, max:38.4, score:0},
    {min:34.0, max:35.9, score:1},
    {min:32.0, max:33.9, score:2},
    {min:30.0, max:31.9, score:3},
    {min:null, max:29.9, score:4},
  ]);

  const hrScore = fgRangeScore(hr, [
    {min:180.001, max:null, score:4},
    {min:140.0, max:179.0, score:3},
    {min:110.0, max:139.0, score:2},
    {min:70.0,  max:109.0, score:0},
    {min:55.0,  max:69.0,  score:2},
    {min:40.0,  max:54.0,  score:3},
    {min:null,  max:39.0,  score:4},
  ]);

  const rrScore = fgRangeScore(rr, [
    {min:50.001, max:null, score:4},
    {min:35.0, max:49.0, score:3},
    {min:25.0, max:34.0, score:1},
    {min:12.0, max:24.0, score:0},
    {min:10.0, max:11.0, score:1},
    {min:6.0,  max:9.0,  score:2},
    {min:null, max:5.0,  score:4},
  ]);

  const naScore = fgRangeScore(na, [
    {min:180.001, max:null, score:4},
    {min:160.0, max:179.0, score:3},
    {min:155.0, max:159.0, score:2},
    {min:150.0, max:154.0, score:1},
    {min:130.0, max:149.0, score:0},
    {min:120.0, max:129.0, score:2},
    {min:111.0, max:119.0, score:3},
    {min:null,  max:110.0, score:4},
  ]);

  const kScore = fgRangeScore(k, [
    {min:7.0,  max:null, score:4},
    {min:6.0,  max:6.9, score:3},
    {min:5.5,  max:5.9, score:1},
    {min:3.5,  max:5.4, score:0},
    {min:3.0,  max:3.4, score:1},
    {min:2.5,  max:2.9, score:2},
    {min:null, max:2.499, score:4},
  ]);

  const crScore = fgRangeScore(cr, [
    {min:3.5,  max:null, score:4},
    {min:2.0,  max:3.4, score:3},
    {min:1.5,  max:1.9, score:2},
    {min:0.6,  max:1.4, score:0},
    {min:null, max:0.599, score:2},
  ]);

  const hctScore = fgRangeScore(hct, [
    {min:60.0, max:null, score:4},
    {min:50.0, max:59.9, score:2},
    {min:46.0, max:49.9, score:1},
    {min:30.0, max:45.9, score:0},
    {min:20.0, max:29.9, score:2},
    {min:null, max:19.999, score:4},
  ]);

  const wbcScore = fgRangeScore(wbc, [
    {min:40.0, max:null, score:4},
    {min:20.0, max:39.9, score:2},
    {min:15.0, max:19.9, score:1},
    {min:3.0,  max:14.9, score:0},
    {min:1.0,  max:2.9,  score:2},
    {min:null, max:0.999, score:4},
  ]);

  const hco3Score = fgRangeScore(hco3, [
    {min:52.0, max:null, score:4},
    {min:41.0, max:51.9, score:3},
    {min:32.0, max:40.9, score:1},
    {min:22.0, max:31.9, score:0},
    {min:18.0, max:21.9, score:2},
    {min:15.0, max:17.9, score:3},
    {min:null, max:14.999, score:4},
  ]);

  const scores = [tempScore,hrScore,rrScore,naScore,kScore,crScore,hctScore,wbcScore,hco3Score];
  const incomplete = scores.some(s => s === null);
  if (incomplete) {
    setResult('fgsi-result', 'neutral', '‚Äî', 'Fill all vitals/labs', 'FGSI requires all 9 parameters to calculate.');
    if(btn) btn.classList.remove('show');
    return;
  }

  const total = scores.reduce((a,b)=>a+b,0);
  let cls='low', label='Lower risk', action='FGSI ‚â§9 (prognostic tool). Use clinical judgment for ICU vs floor, operative urgency, etc.';
  if (total > 9) { cls='high'; label='High mortality risk'; action='FGSI >9 is commonly associated with high mortality risk; supports ICU-level care and aggressive management.'; }

  setResult('fgsi-result', cls, String(total), label, action);
  if(btn) btn.classList.add('show');
}

function resetFGSI() {
  ['fg-temp','fg-hr','fg-rr','fg-na','fg-k','fg-cr','fg-hct','fg-wbc','fg-hco3'].forEach(id => { const el=document.getElementById(id); if(el) el.value=''; });
  calcFGSI();
}

// SIRS
let sirsChecked = [false,false,false,false];
function toggleSIRS(i){
  sirsChecked[i] = !sirsChecked[i];
  const box = document.getElementById('sirs'+i);
  if(box) box.checked = sirsChecked[i];
  updateSIRS();
}
function updateSIRS(){
  const n = sirsChecked.filter(Boolean).length;
  const cls = (n>=2) ? 'moderate' : 'neutral';
  setResult('sirs-result', cls, String(n), (n>=2?'SIRS positive':'SIRS not met'), 'SIRS is supportive context; not a sepsis definition by itself.');
  const btn = document.getElementById('sirs-copy-btn');
  if(btn) btn.classList.toggle('show', n>0);
}
function resetSIRS(){
  sirsChecked=[false,false,false,false];
  for(let i=0;i<4;i++){ const box=document.getElementById('sirs'+i); if(box) box.checked=false; }
  updateSIRS();
}

// qSOFA
let qsofaChecked = [false,false,false];
function toggleQSOFA(i){
  qsofaChecked[i] = !qsofaChecked[i];
  const box = document.getElementById('qsofa'+i);
  if(box) box.checked = qsofaChecked[i];
  updateQSOFA();
}
function updateQSOFA(){
  const n = qsofaChecked.filter(Boolean).length;
  const cls = (n>=2) ? 'high' : (n===1 ? 'moderate' : 'neutral');
  setResult('qsofa-result', cls, String(n), (n>=2?'High risk':'qSOFA score'), 'qSOFA is a mortality risk screen; escalate care when concerning.');
  const btn = document.getElementById('qsofa-copy-btn');
  if(btn) btn.classList.toggle('show', n>0);
}
function resetQSOFA(){
  qsofaChecked=[false,false,false];
  for(let i=0;i<3;i++){ const box=document.getElementById('qsofa'+i); if(box) box.checked=false; }
  updateQSOFA();
}

// Shock Index
function calcShockIndex(){
  const hr = parseFloat(document.getElementById('si-hr').value);
  const sbp = parseFloat(document.getElementById('si-sbp').value);
  const btn = document.getElementById('si-copy-btn');
  if (Number.isNaN(hr) || Number.isNaN(sbp) || sbp<=0){
    setResult('si-result','neutral','‚Äî','Enter HR + SBP','Shock Index = HR/SBP.');
    if(btn) btn.classList.remove('show');
    return;
  }
  const si = hr/sbp;
  let cls='neutral', label='Shock Index', action='Interpret in clinical context.';
  if (si > 0.9){ cls='moderate'; label='Concerning'; action='Shock Index >0.9 can indicate occult shock. Reassess perfusion, lactate, and resuscitate/escalate as appropriate.'; }
  if (si >= 1.3){ cls='high'; label='High concern'; action='Shock Index ‚â•1.3 suggests significant shock physiology ‚Üí aggressive resuscitation/escalation.'; }
  setResult('si-result', cls, si.toFixed(2), label, action);
  if(btn) btn.classList.add('show');
}
function resetShockIndex(){
  const a=document.getElementById('si-hr'); if(a) a.value='';
  const b=document.getElementById('si-sbp'); if(b) b.value='';
  calcShockIndex();
}

// Initialize defaults
updateSIRS();
updateQSOFA();


// ‚îÄ‚îÄ CENTOR / MCISAAC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function calcCentor() {
  const ex = document.getElementById('centor-exudate').checked;
  const nd = document.getElementById('centor-nodes').checked;
  const fv = document.getElementById('centor-fever').checked;
  const nc = document.getElementById('centor-nocough').checked;

  let score = (ex?1:0) + (nd?1:0) + (fv?1:0) + (nc?1:0);

  const ageEl = document.querySelector('input[name="centor-age"]:checked');
  const ageAdj = ageEl ? parseInt(ageEl.value,10) : null;
  if(ageAdj !== null) score += ageAdj;

  const breakdown = [];
  if(ex) breakdown.push('Tonsillar exudates (+1)');
  if(nd) breakdown.push('Tender anterior cervical adenopathy (+1)');
  if(fv) breakdown.push('Fever ‚â•38¬∞C (+1)');
  if(nc) breakdown.push('No cough (+1)');
  if(ageAdj !== null){
    if(ageAdj === 1) breakdown.push('Age 3‚Äì14 (+1)');
    else if(ageAdj === 0) breakdown.push('Age 15‚Äì44 (0)');
    else if(ageAdj === -1) breakdown.push('Age ‚â•45 (‚àí1)');
  }

  const box = document.getElementById('centor-result');
  const copyBtn = document.getElementById('centor-copy-btn');

  if(ageAdj === null && !ex && !nd && !fv && !nc){
    box.className = 'result neutral';
    box.innerHTML = '<div class="result-score">‚Äî</div><div class="result-label">Select criteria</div><div class="result-action">Choose findings to calculate score.</div>';
    if(copyBtn) copyBtn.classList.remove('show');
    centorState = {score:null, breakdown:[], plan:''};
    return;
  }

  let plan = '';
  // Conservative, commonly-used approach (test vs treat varies by local protocol)
  if(score <= 1){
    plan = 'Low risk. Recommend no GAS testing and no antibiotics (supportive care) unless clinical concern warrants.';
    box.className = 'result low';
  } else if(score === 2 || score === 3){
    plan = 'Intermediate risk. Recommend rapid antigen detection test (RADT) and treat if positive; consider culture per local protocol.';
    box.className = 'result moderate';
  } else {
    plan = 'Higher risk. Consider RADT/culture and empiric treatment based on local protocol and shared decision-making.';
    box.className = 'result high';
  }

  box.innerHTML = `<div class="result-score">${score}</div>
                   <div class="result-label">${plan}</div>
                   <div class="result-action">Centor/McIsaac documentation available via copy button.</div>`;

  if(copyBtn) copyBtn.classList.add('show');
  centorState = {score, breakdown, plan};
}

function resetCentor(){
  ['centor-exudate','centor-nodes','centor-fever','centor-nocough'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.checked=false;
  });
  document.querySelectorAll('input[name="centor-age"]').forEach(r=>r.checked=false);
  const box=document.getElementById('centor-result');
  if(box){
    box.className='result neutral';
    box.innerHTML='<div class="result-score">‚Äî</div><div class="result-label">Select criteria</div><div class="result-action">Choose findings to calculate score.</div>';
  }
  const btn=document.getElementById('centor-copy-btn');
  if(btn) btn.classList.remove('show');
  centorState={score:null, breakdown:[], plan:''};
}

// ‚îÄ‚îÄ PECARN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PECARN = {
  lt2: {
    high: [
      {id:'p_lt2_ams', label:'Altered mental status'},
      {id:'p_lt2_palpskull', label:'Palpable skull fracture'}
    ],
    inter: [
      {id:'p_lt2_scalp', label:'Non-frontal scalp hematoma (occipital/parietal/temporal)'},
      {id:'p_lt2_loc', label:'Loss of consciousness ‚â• 5 seconds'},
      {id:'p_lt2_sevmech', label:'Severe mechanism of injury'},
      {id:'p_lt2_notnormal', label:'Not acting normally per parent'}
    ]
  },
  ge2: {
    high: [
      {id:'p_ge2_ams', label:'Altered mental status'},
      {id:'p_ge2_basilar', label:'Signs of basilar skull fracture'}
    ],
    inter: [
      {id:'p_ge2_loc', label:'Any loss of consciousness'},
      {id:'p_ge2_vomit', label:'Vomiting'},
      {id:'p_ge2_sevhead', label:'Severe headache'},
      {id:'p_ge2_sevmech', label:'Severe mechanism of injury'}
    ]
  }
};

function renderPecarn(){
  const age = document.querySelector('input[name="pecarn-age"]:checked');
  const wrap = document.getElementById('pecarn-criteria-wrap');
  if (!wrap) return;

  if (!age) { wrap.innerHTML = ''; return; }

  const cfg = PECARN[age.value];
  const mkRow = (o, pts) => `
    <div class="criterion" onclick="toggleById('${o.id}')">
      <input type="checkbox" id="${o.id}" onchange="calcPecarn()">
      <span class="criterion-label">${o.label}</span>
      <span class="criterion-pts">${pts}</span>
    </div>`;

  wrap.innerHTML = `
    <div style="margin-top:8px;font-size:11px;color:#64748b;font-weight:700;text-transform:uppercase;letter-spacing:.6px">High risk</div>
    ${cfg.high.map(o => mkRow(o, 'CT')).join('')}
    <div style="margin-top:14px;font-size:11px;color:#64748b;font-weight:700;text-transform:uppercase;letter-spacing:.6px">Intermediate risk</div>
    ${cfg.inter.map(o => mkRow(o, 'Obs/CT')).join('')}
  `;
}

function toggleById(id){
  const el = document.getElementById(id);
  if (!el) return;
  el.checked = !el.checked;
  calcPecarn();
}

function calcPecarn(){
  const ageEl = document.querySelector('input[name="pecarn-age"]:checked');
  const box = document.getElementById('pecarn-result');
  const copyBtn = document.getElementById('pecarn-copy-btn');
  if (!box) return;

  if (!ageEl) {
    box.className = 'result neutral';
    box.innerHTML = '<div class="result-score">‚Äî</div><div class="result-label">Select age group</div><div class="result-action">Choose &lt;2 vs ‚â•2 years first.</div>';
    if(copyBtn) copyBtn.classList.remove('show');
    pecarnState = {ageGroup:null, checked:[], recommendation:''};
    return;
  }

  const ageGroup = ageEl.value; // lt2 or ge2
  const cfg = PECARN[ageGroup];

  const checked = [];
  let anyHigh = false;
  let anyInter = false;

  cfg.high.forEach(o=>{
    const el = document.getElementById(o.id);
    if(el && el.checked){ anyHigh = true; checked.push(o.label); }
  });
  cfg.inter.forEach(o=>{
    const el = document.getElementById(o.id);
    if(el && el.checked){ anyInter = true; checked.push(o.label); }
  });

  let rec = '';
  if(anyHigh){
    rec = 'CT head recommended (PECARN high-risk feature present).';
    box.className = 'result high';
  } else if(anyInter){
    rec = 'Observation vs CT head (PECARN intermediate-risk feature present).';
    box.className = 'result moderate';
  } else {
    rec = 'No CT head recommended (no PECARN high/intermediate features selected).';
    box.className = 'result low';
  }

  box.innerHTML = `<div class="result-score">${anyHigh?'CT':(anyInter?'OBS/CT':'NO CT')}</div>
                   <div class="result-label">${rec}</div>
                   <div class="result-action">Copy documentation if needed.</div>`;

  if(copyBtn) copyBtn.classList.add('show');
  pecarnState = {ageGroup, checked, recommendation: rec};
}

function resetPecarn(){
  document.querySelectorAll('input[name="pecarn-age"]').forEach(r => r.checked = false);
  const wrap = document.getElementById('pecarn-criteria-wrap');
  if(wrap) wrap.innerHTML = '';
  const box = document.getElementById('pecarn-result');
  if(box){
    box.className = 'result neutral';
    box.innerHTML = '<div class="result-score">‚Äî</div><div class="result-label">Select age group</div><div class="result-action">Choose &lt;2 vs ‚â•2 years first.</div>';
  }
  const btn = document.getElementById('pecarn-copy-btn');
  if(btn) btn.classList.remove('show');
  pecarnState = {ageGroup:null, checked:[], recommendation:''};
}
</script>
</body>
</html>
