<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ER Dotphrases</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Inter',system-ui,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}
header{background:linear-gradient(135deg,#1e293b,#0f172a);border-bottom:1px solid #1e3a5f;padding:20px 24px}
.header-inner{max-width:900px;margin:0 auto}
.logo{display:flex;align-items:center;gap:10px;margin-bottom:4px}
.logo span{font-size:22px}.logo h1{font-size:20px;font-weight:700;color:#f1f5f9}
.subtitle{font-size:13px;color:#64748b;margin-left:32px;margin-bottom:12px}
.disclaimer{background:#1e3a5f;border:1px solid #2563eb;border-radius:8px;padding:10px 14px;margin-bottom:14px;font-size:12px;color:#93c5fd;line-height:1.5}
.disclaimer strong{color:#bfdbfe}
#search{width:100%;padding:12px 16px;background:#1e293b;border:1px solid #334155;border-radius:10px;color:#f1f5f9;font-size:15px;outline:none;transition:border-color .2s}
#search:focus{border-color:#3b82f6}
#search::placeholder{color:#475569}
nav{background:#0f172a;border-bottom:1px solid #1e293b;overflow-x:auto;-webkit-overflow-scrolling:touch}
.tabs{max-width:900px;margin:0 auto;display:flex;gap:4px;padding:8px 24px}
.tab{padding:6px 14px;border-radius:20px;border:none;cursor:pointer;font-size:13px;font-weight:500;white-space:nowrap;background:#1e293b;color:#94a3b8;transition:all .2s}
.tab.active{background:#3b82f6;color:#fff}
main{max-width:900px;margin:0 auto;padding:16px 24px 60px}
.count{font-size:12px;color:#475569;margin-bottom:12px}
.card{background:#1e293b;border:1px solid #334155;border-radius:12px;margin-bottom:12px;overflow:hidden;transition:border-color .2s}
.card:hover{border-color:#3b82f6}
.card-header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #334155;gap:8px;flex-wrap:wrap}
.card-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.dotphrase{background:#0f172a;color:#38bdf8;padding:3px 10px;border-radius:6px;font-size:13px;font-weight:700;border:1px solid #1e3a5f;font-family:monospace}
.condition{font-weight:600;font-size:14px;color:#f1f5f9}
.category-tag{font-size:11px;background:#0f172a;color:#64748b;padding:2px 8px;border-radius:20px;border:1px solid #1e293b}
.copy-btn{padding:6px 14px;border-radius:8px;border:none;cursor:pointer;font-size:12px;font-weight:600;background:#3b82f6;color:#fff;transition:background .2s;white-space:nowrap;flex-shrink:0}
.copy-btn.copied{background:#16a34a}
.card-body{padding:12px 16px;font-size:13px;line-height:1.75;color:#cbd5e1}
.empty{text-align:center;color:#475569;margin-top:60px;font-size:15px}
@media(max-width:600px){.card-header{flex-direction:column;align-items:flex-start}.copy-btn{width:100%}}

/* ===== SHARED NEW NAV ===== */
@media(max-width:640px){}
.sitenav{background:#0d1829;border-bottom:1px solid #1a2d48;position:sticky;top:0;z-index:100;font-family:'DM Sans',system-ui,sans-serif}
.sitenav-inner{max-width:1200px;margin:0 auto;padding:0 20px;display:flex;align-items:center;gap:6px;height:46px;overflow:hidden}
.nav-logo{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:#3b82f6;white-space:nowrap;flex-shrink:0;text-decoration:none;margin-right:6px}
.nav-logo span{color:#4a6280}
.nav-links{display:flex;flex:1;min-width:0;gap:1px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;white-space:nowrap;padding-right:10px}
.nav-links::-webkit-scrollbar{display:none}
.nav-link{padding:5px 10px;border-radius:6px;font-size:12px;font-weight:600;color:#8fa8c8;text-decoration:none;white-space:nowrap;transition:all .15s}
.nav-link:hover{background:#111f35;color:#e8f0fc}
.nav-link.active{background:#1d4ed8;color:#fff}
@media(max-width:640px){.nav-link{font-size:11px;padding:4px 8px}}
</style>
</head>
<body>
<nav class="sitenav">
  <div class="sitenav-inner">
    <a class="nav-logo" href="index.html">‚ö° KP<span>/</span>ER</a>
    <div class="nav-links">
      <a class="nav-link" href="index.html">üè† Home</a>
      <a class="nav-link active" href="dotphrase.html">üìã Phrases</a>
      <a class="nav-link" href="mdm.html">üßæ MDM</a>
      <a class="nav-link" href="calculators.html">üßÆ Calcs</a>
      <a class="nav-link" href="vasopressors.html">üíä Vasopressors</a>
      <a class="nav-link" href="rsi.html">ü´Å RSI</a>
      <a class="nav-link" href="algorithms.html">üîÄ Algorithms</a>
      <a class="nav-link" href="neurohub.html">üß† Neuro Hub</a>
      <a class="nav-link" href="pedsfever.html">üå°Ô∏è Peds Fever</a>
      <a class="nav-link" href="service-agreements.html">üìë Service Agreements</a>
      <a class="nav-link" href="ed-phone-directory.html">üìû Directory</a>
      <a class="nav-link" href="links.html">üîó Links</a>
      <a class="nav-link" href="roadmap.html">üó∫Ô∏è Roadmap</a>
    </div>
  </div>
</nav>
<header>
  <div class="header-inner">
    <div class="logo"><span>üè•</span><h1>ER Rule-Out Dotphrases</h1></div>
    <p class="subtitle">Search all dotphrases or browse by category</p>
    <div class="disclaimer"><strong>‚ö†Ô∏è Clinical Disclaimer:</strong> These are documentation templates only. All phrases must be reviewed, individualized, and verified by the treating physician before use. Do not copy without confirming accuracy for each patient encounter. Templates do not substitute for clinical judgment.</div>
    <input id="search" type="text" placeholder="Search: nosah, PE, DKA, compartment, abscess..." oninput="render()"/>
  </div>
</header>
<nav><div class="tabs" id="tabs"></div></nav>
<main><p class="count" id="count"></p><div id="main"></div></main>

<script src="search-index.js"></script>
<script src="data/dotphrases.js"></script>
<script>
const phrases = Array.isArray(window.KP_DOTPHRASES) ? window.KP_DOTPHRASES : [];

const cats = ["All", ...Array.from(new Set(phrases.map(p => p.cat)))];
let activeCategory = "All";

const tabsEl = document.getElementById("tabs");
cats.forEach(cat => {
  const btn = document.createElement("button");
  btn.className = "tab" + (cat === "All" ? " active" : "");
  btn.textContent = cat;
  btn.onclick = () => {
    activeCategory = cat;
    document.querySelectorAll(".tab").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    render();
  };
  tabsEl.appendChild(btn);
});

function getFiltered() {
  const q = document.getElementById("search").value.toLowerCase();
  return phrases.filter(p => {
    const matchSearch = !q || p.dot.includes(q) || p.cond.toLowerCase().includes(q)
      || p.cat.toLowerCase().includes(q) || p.text.toLowerCase().includes(q);
    const matchCat = activeCategory === "All" || p.cat === activeCategory;
    return matchSearch && matchCat;
  });
}

function render() {
  const filtered = getFiltered();
  const mainEl = document.getElementById("main");
  const countEl = document.getElementById("count");
  countEl.textContent = `${filtered.length} dotphrase${filtered.length !== 1 ? "s" : ""} ${activeCategory !== "All" ? "in " + activeCategory : "total"}`;
  if (filtered.length === 0) {
    mainEl.innerHTML = '<p class="empty">No dotphrases found. Try a different search.</p>';
    return;
  }
  mainEl.innerHTML = filtered.map((p, i) => `
    <div class="card">
      <div class="card-header">
        <div class="card-meta">
          <span class="dotphrase">.${p.dot}</span>
          <span class="condition">${p.cond}</span>
          <span class="category-tag">${p.cat}</span>
        </div>
        <button class="copy-btn" id="btn-${i}" onclick="copyText(${i})">Copy</button>
      </div>
      <p class="card-body">${p.text}</p>
    </div>
  `).join("");
}

function copyText(i) {
  const filtered = getFiltered();
  const text = filtered[i] ? filtered[i].text : "";
  const btn = document.getElementById("btn-" + i);
  if (!text || !btn) return;

  const fallbackCopy = () => {
    const ta = document.createElement("textarea");
    ta.value = text;
    ta.setAttribute("readonly", "");
    ta.style.position = "fixed";
    ta.style.top = "-9999px";
    ta.style.left = "-9999px";
    document.body.appendChild(ta);
    ta.focus();
    ta.select();
    let ok = false;
    try {
      ok = document.execCommand("copy");
    } catch (e) {
      ok = false;
    }
    document.body.removeChild(ta);
    return ok;
  };

  const onSuccess = () => {
    btn.textContent = "‚úì Copied!";
    btn.classList.add("copied");
    setTimeout(() => { btn.textContent = "Copy"; btn.classList.remove("copied"); }, 2000);
  };

  const onFailure = () => {
    btn.textContent = "Copy failed";
    btn.classList.remove("copied");
    setTimeout(() => { btn.textContent = "Copy"; }, 2000);
  };

  if (navigator.clipboard && window.isSecureContext) {
    navigator.clipboard.writeText(text).then(onSuccess).catch(() => {
      if (fallbackCopy()) onSuccess();
      else onFailure();
    });
  } else if (fallbackCopy()) {
    onSuccess();
  } else {
    onFailure();
  }
}

render();
</script>

<script id="shared-nav-search">
</script>

</body>
</html>
